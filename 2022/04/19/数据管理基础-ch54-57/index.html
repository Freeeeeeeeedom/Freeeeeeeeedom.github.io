<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>数据管理基础 ch54-57 | 投降输一半</title><meta name="keywords" content="数据管理基础"><meta name="author" content="胡小小小小睿"><meta name="copyright" content="胡小小小小睿"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="并发控制"><meta property="og:type" content="article"><meta property="og:title" content="数据管理基础 ch54-57"><meta property="og:url" content="http://little-hurui.cloud/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/index.html"><meta property="og:site_name" content="投降输一半"><meta property="og:description" content="并发控制"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2022/04/21/GwB7I2bi1OP3RzW.jpg"><meta property="article:published_time" content="2022-04-19T07:07:55.000Z"><meta property="article:modified_time" content="2022-04-29T10:11:36.261Z"><meta property="article:author" content="胡小小小小睿"><meta property="article:tag" content="数据管理基础"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2022/04/21/GwB7I2bi1OP3RzW.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2022/04/19/olzB7QMiuGqbjHe.jpg"><link rel="canonical" href="http://little-hurui.cloud/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"数据管理基础 ch54-57",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-04-29 18:11:36"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0!==o){const a=new Date;o=864e5*o,t={value:t,expiry:a.getTime()+o};localStorage.setItem(e,JSON.stringify(t))}},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);const o=new Date;if(!(o.getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=a=>new Promise((t,e)=>{const o=document.createElement("script");o.src=a,o.async=!0,o.onerror=e,o.onload=o.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(o.onload=o.onreadystatechange=null,t())},document.head.appendChild(o)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="投降输一半" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/04/20/iVOmaCTznfybv2A.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">108</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/notes/"><i class="fa-fw fa fa-bold"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://s2.loli.net/2022/04/21/GwB7I2bi1OP3RzW.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">投降输一半</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/notes/"><i class="fa-fw fa fa-bold"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">数据管理基础 ch54-57</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-19T07:07:55.000Z" title="发表于 2022-04-19 15:07:55">2022-04-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-04-29T10:11:36.261Z" title="更新于 2022-04-29 18:11:36">2022-04-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/">数据管理基础</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">6.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="数据管理基础 ch54-57"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ch-54-并发控制"><a class="markdownIt-Anchor" href="#ch-54-并发控制"></a> ch 54 并发控制</h1><h2 id="事务并发"><a class="markdownIt-Anchor" href="#事务并发"></a> 事务并发</h2><ul><li>多用户数据库系统，允许多个用户同时使用的数据库系统<ul><li>飞机定票数据库系统</li><li>银行数据库系统</li></ul></li><li>特点：在同一时刻并发运行的事务数可达数百上千个</li><li>事务并发执行带来的问题<ul><li>会产生多个事务同时存取同一数据的情况</li><li>可能会存取和存储不正确的数据，破坏事务隔离性和数据库的一致性</li></ul></li><li>数据库管理系统必须提供并发控制机制，并发控制机制是衡量一个数据库管理系统性能的重要标志之一</li></ul><h2 id="多事务执行方式"><a class="markdownIt-Anchor" href="#多事务执行方式"></a> 多事务执行方式</h2><p><strong>多事务执行方式 1</strong></p><ul><li><p>事务串行执行</p><ul><li>每个时刻只有一个事务运行，其他事务必须等到这个事务结束以后方能运行</li><li>不能充分利用系统资源，发挥数据库共享资源的特点</li></ul><p><img src="https://s2.loli.net/2022/04/19/wvLj91aGogIJbCe.png" alt=""></p></li></ul><p><strong>多事务执行方式 2</strong></p><ul><li>交叉并发方式（Interleaved Concurrency）<ul><li>在单处理机系统中，事务的并行执行是这些并行事务的并行操作轮流交叉运行</li><li>单处理机系统中的并行事务并没有真正地并行运行，但能够减少处理机的空闲时间，提高系统的效率</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/19/NEqOBMGsrAvUuYe.png" alt=""></p><p><strong>多事务执行方式 3</strong></p><ul><li>同时并发方式（simultaneous concurrency）<ul><li>多处理机系统中，每个处理机可以运行一个事务，多个处理机可以同时运行多个事务，实现多个事务真正的并行运行</li><li>最理想的并发方式，但受制于硬件环境</li><li>更复杂的并发方式机制</li></ul></li></ul><h2 id="不一致性的例子"><a class="markdownIt-Anchor" href="#不一致性的例子"></a> 不一致性的例子</h2><p><strong>不一致性的例子 1</strong></p><ul><li>[例11.1]飞机订票系统中的一个活动序列<ol><li>甲售票点(事务T1)读出某航班的机票余额A，设A=16；</li><li>乙售票点(事务T2)读出同一航班的机票余额A，也为16；</li><li>甲售票点卖出一张机票，修改余额A←A-1，所以A为15，把A写回数据库；</li><li>乙售票点也卖出一张机票，修改余额A←A-1，所以A为15，把A写回数据库</li><li>结果明明卖出两张机票，数据库中机票余额只减少1</li></ol></li></ul><p><strong>不一致性的例子 2</strong></p><ul><li>这种情况称为数据库的不一致性，是由并发操作引起的。</li><li>在并发操作情况下，对T1、T2两个事务的操作序列的调度是随机的。</li><li>若按上面的调度序列执行， T1事务的修改就被丢失。<ul><li>原因：第4步中T2事务修改A并写回后覆盖了T1事务的修改</li></ul></li></ul><h2 id="并发操作带来的数据不一致性"><a class="markdownIt-Anchor" href="#并发操作带来的数据不一致性"></a> 并发操作带来的数据不一致性</h2><ul><li>丢失修改（Lost Update）</li><li>不可重复读（Non-repeatable Read）</li><li>读“脏”数据（Dirty Read）</li><li>记号<ul><li>R(x):读数据x</li><li>W(x):写数据x</li></ul></li></ul><h3 id="丢失修改"><a class="markdownIt-Anchor" href="#丢失修改"></a> 丢失修改</h3><ul><li>两个事务T1和T2读入同一数据并修改， T2的提交结果破坏了T1提交的结果，导致T1的修改被丢失。</li><li>上面飞机订票例子就属此类</li></ul><p><img src="https://s2.loli.net/2022/04/19/pfCdFYv62DNyb7o.png" alt=""></p><h3 id="不可重复读"><a class="markdownIt-Anchor" href="#不可重复读"></a> 不可重复读</h3><p><strong>不可重复读 1</strong></p><ul><li>不可重复读是指事务T1读取数据后，事务T2执行更新操作，使T1无法再现前一次读取结果。</li><li>不可重复读包括三种情况， 后两种不可重复读有时也称为幻影现象（Phantom Row）：<ul><li>事务T1读取某一数据后，事务T2对其做了修改，当事务T1再次读该数据时，得到与前一次不同的值</li><li>事务T1按一定条件从数据库中读取了某些数据记录后，事务T2删除了其中部分记录，当T1再次按相同条件读取数据时，发现某些记录神秘地消失了。</li><li>事务T1按一定条件从数据库中读取某些数据记录后，事务T2插入了一些记录，当T1再次按相同条件读取数据时，发现多了一些记录。</li></ul></li></ul><p><strong>不可重复读 2</strong></p><p><img src="https://s2.loli.net/2022/04/19/PWnyNQUZ7IbafiB.png" alt=""></p><ul><li>T1读取B=100进行运算</li><li>T2读取同一数据B，对其进行修改后将B=200写回数据库。</li><li>T1为了对读取值校对重读B，B已为200，与第一次读取值不一致</li></ul><h3 id="读脏数据"><a class="markdownIt-Anchor" href="#读脏数据"></a> 读“脏”数据</h3><p><strong>读“脏”数据 1</strong></p><ul><li>读“脏”数据是指：<ul><li>事务T1修改某一数据，并将其写回磁盘</li><li>事务T2读取同一数据后， T1由于某种原因被撤销</li><li>这时T1已修改过的数据恢复原值， T2读到的数据就与数据库中的数据不一致</li><li>T2读到的数据就为“脏”数据，即不正确的数据</li></ul></li></ul><p><strong>读“脏”数据 2</strong></p><ul><li>T1将C值修改为200， T2读到C为200</li><li>T1由于某种原因撤销，其修改作废，C恢复原值100</li><li>这时T2读到的C为200，与数据库内容不一致，就是“脏”数据</li></ul><p><img src="https://s2.loli.net/2022/04/19/pltRD7ZgLKX3vkf.png" alt=""></p><h2 id="数据不一致性及并发控制"><a class="markdownIt-Anchor" href="#数据不一致性及并发控制"></a> 数据不一致性及并发控制</h2><ul><li>数据不一致性：由于并发操作破坏了事务的隔离性</li><li>并发控制就是要用正确的方式调度并发操作，使一个用户事务的执行不受其他事务的干扰，从而避免造成数据的不一致性</li><li>对数据库的应用有时允许某些不一致性，例如有些统计工作涉及数据量很大，读到一些“脏”数据对统计精度没什么影响，可以降低对一致性的要求以减少系统开销</li></ul><h2 id="并发控制的主要技术"><a class="markdownIt-Anchor" href="#并发控制的主要技术"></a> 并发控制的主要技术</h2><ul><li>并发控制的主要技术<ul><li>封锁(Locking)</li><li>时间戳(Timestamp)</li><li>乐观控制法</li><li>多版本并发控制(MVCC)</li></ul></li></ul><h1 id="ch-55-封锁"><a class="markdownIt-Anchor" href="#ch-55-封锁"></a> ch 55 封锁</h1><h2 id="封锁"><a class="markdownIt-Anchor" href="#封锁"></a> 封锁</h2><ul><li>封锁就是事务T在对某个数据对象（例如表、记录等）操作之前，先向系统发出请求，对其加锁</li><li>加锁后事务T就对该数据对象有了一定的控制，在事务T释放它的锁之前，其它的事务不能更新此数据对象。</li><li>封锁是实现并发控制的一个非常重要的技术</li><li>一个事务对某个数据对象加锁后究竟拥有什么样的控制由封锁的类型决定。</li><li>基本封锁类型<ul><li>排它锁（Exclusive Locks，简记为X锁）</li><li>共享锁（Share Locks，简记为S锁）</li></ul></li></ul><h2 id="排它锁与共享锁"><a class="markdownIt-Anchor" href="#排它锁与共享锁"></a> 排它锁与共享锁</h2><ul><li>排它锁又称为<strong>写锁</strong><ul><li>若事务T对数据对象A加上X锁，则只允许T读取和修改A，<strong>其它任何事务都不能再对A加任何类型的锁，直到T释放A上的锁</strong></li><li>保证其他事务在T释放A上的锁之前不能再读取和修改A</li></ul></li><li>共享锁又称为<strong>读锁</strong><ul><li>若事务T对数据对象A加上S锁，则事务T可以读A但不能修改A，其它事务<strong>只能再对A加S锁，而不能加X锁</strong>，直到T释放A上的S锁</li><li>保证其他事务可以读A，但在T释放A上的S锁之前不能对A做任何修改</li></ul></li></ul><h2 id="锁的相容矩阵"><a class="markdownIt-Anchor" href="#锁的相容矩阵"></a> 锁的相容矩阵</h2><p><strong>锁的相容矩阵 1</strong></p><p><img src="https://s2.loli.net/2022/04/26/39wSpqE267RHJLM.png" alt=""></p><p><strong>锁的相容矩阵 2</strong></p><ul><li>在锁的相容矩阵中：</li><li>最左边一列表示事务T1已经获得的数据对象上的锁的类型，其中横线表示没有加锁。</li><li>最上面一行表示另一事务T2对同一数据对象发出的封锁请求。</li><li>T2的封锁请求能否被满足用矩阵中的Y和N表示<ul><li>Y表示事务T2的封锁要求与T1已持有的锁相容，封锁请求可以满足</li><li>N表示T2的封锁请求与T1已持有的锁冲突， T2的请求被拒绝</li></ul></li></ul><h2 id="封锁协议"><a class="markdownIt-Anchor" href="#封锁协议"></a> 封锁协议</h2><ul><li>在运用X锁和S锁对数据对象加锁时，需要约定一些规则，这些规则为封锁协议（Locking Protocol）。<ul><li>何时申请X锁或S锁</li><li>持锁时间</li><li>何时释放</li></ul></li><li>对封锁方式规定不同的规则，就形成了各种不同的封锁协议，它们分别在不同的程度上为并发操作的正确调度提供一定的保证。</li></ul><h2 id="一级封锁协议"><a class="markdownIt-Anchor" href="#一级封锁协议"></a> 一级封锁协议</h2><p><strong>一级封锁协议</strong> 1</p><ul><li>一级封锁协议<ul><li>事务T在修改数据R之前必须先对其加X锁，直到事务结束才释放。<ul><li>正常结束（COMMIT）</li><li>非正常结束（ROLLBACK）</li></ul></li></ul></li><li>一级封锁协议可防止丢失修改，并保证事务T是可恢复的。</li><li>在一级封锁协议中，如果仅仅是读数据不对其进行修改，是不需要加锁的，所以它不能保证可重复读和不读“脏”数据。</li></ul><p><strong>一级封锁协议 2</strong></p><p><img src="https://s2.loli.net/2022/04/26/mOJTFxGq76ClB9a.png" alt=""></p><ul><li>事务T1在读A进行修改之前先对A加X锁</li><li>当T2再请求对A加X锁时被拒绝</li><li>T2只能等待T1释放A上的锁后获得对A的X锁</li><li>这时T2读到的A已经是T1更新过的值15</li><li>T2按此新的A值进行运算，并将结果值A=14写回到磁盘。避免了丢失T1的更新。</li></ul><h2 id="二级封锁协议"><a class="markdownIt-Anchor" href="#二级封锁协议"></a> 二级封锁协议</h2><p><strong>二级封锁协议 1</strong></p><ul><li>二级封锁协议<ul><li>一级封锁协议加上事务T在读取数据R之前必须先对其加S锁，读完后即可释放S锁。</li></ul></li><li>二级封锁协议可以防止丢失修改和读“脏”数据。</li><li>在二级封锁协议中，由于读完数据后即可释放S锁，所以它不能保证可重复读。</li></ul><p><strong>二级封锁协议 2</strong></p><p><img src="https://s2.loli.net/2022/04/26/sgXaJMI4CxVEvYH.png" alt=""></p><ul><li>事务T1在对C进行修改之前，先对C加X锁，修改其值后写回磁盘</li><li>T2请求在C上加S锁，因T1已在C上加了X锁， T2只能等待</li><li>T1因某种原因被撤销，C恢复为原值100</li><li>T1释放C上的X锁后T2获得C上的S锁，读C=100。避免了T2读“脏”数据</li></ul><h2 id="三级封锁协议"><a class="markdownIt-Anchor" href="#三级封锁协议"></a> 三级封锁协议</h2><p><strong>三级封锁协议 1</strong></p><ul><li>三级封锁协议<ul><li>一级封锁协议加上事务T在读取数据R之前必须先对其加S锁，直到事务结束才释放。</li></ul></li><li>三级封锁协议可防止丢失修改、读脏数据和不可重复读。</li></ul><p><strong>三级封锁协议 2</strong></p><p><img src="https://s2.loli.net/2022/04/26/xa4X1Yigyd9HGlu.png" alt=""></p><ul><li>事务T1在读A，B之前，先对A，B加S锁</li><li>其他事务只能再对A，B加S锁，而不能加X锁，即其他事务只能读A，B，而不能修改</li><li>当T2为修改B而申请对B的X锁时被拒绝只能等待T1释放B上的锁</li><li>T1为验算再读A，B，这时读出的B仍是100，求和结果仍为150，即可重复读</li><li>T1结束才释放A，B上的S锁。 T2才获得对B的X锁</li></ul><h2 id="封锁协议小结"><a class="markdownIt-Anchor" href="#封锁协议小结"></a> 封锁协议小结</h2><ul><li>三级协议的主要区别<ul><li>什么操作需要申请封锁以及何时释放锁（即持锁时间）</li></ul></li><li>不同的封锁协议使事务达到的一致性级别不同<ul><li>封锁协议级别越高，一致性程度越高</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/26/cLHSIurQoqFBC4b.png" alt=""></p><h2 id="活锁"><a class="markdownIt-Anchor" href="#活锁"></a> 活锁</h2><p><strong>活锁 1</strong></p><ul><li>事务T1封锁了数据R</li><li>事务T2又请求封锁R，于是T2等待。</li><li>T3也请求封锁R，当T1释放了R上的封锁之后系统首先批准了T3的请求，T2仍然等待。</li><li>T4又请求封锁R，当T3释放了R上的封锁之后系统又批准了T4的请求……</li><li>T2有可能永远等待，这就是活锁的情形</li><li>避免活锁：采用<strong>先来先服务</strong>的策略<ul><li>当多个事务请求封锁同一数据对象时</li><li>按请求封锁的先后次序对这些事务排队</li><li>该数据对象上的锁一旦释放，首先批准申请队列中第一个事务获得锁</li></ul></li></ul><p><strong>活锁 2</strong></p><p><img src="https://s2.loli.net/2022/04/26/WI7OwFpYZcRo3tT.png" alt=""></p><h2 id="死锁"><a class="markdownIt-Anchor" href="#死锁"></a> 死锁</h2><p><strong>死锁 1</strong></p><ul><li>事务T1封锁了数据R1（可以认为均是X锁）</li><li>T2封锁了数据R2</li><li>T1又请求封锁R2 ，因T2已封锁了R2 ，于是T1等待T2释放R2上的锁</li><li>接着T2又申请封锁R1 ，因T1已封锁了R1 ， T2也只能等待T1释放R1上的锁</li><li>这样T1在等待T2 ，而T2又在等待T1 ， T1和T2两个事务永远不能结束，形成死锁</li></ul><p><strong>死锁 2</strong></p><p><img src="https://s2.loli.net/2022/04/26/WI7OwFpYZcRo3tT.png" alt=""></p><h2 id="死锁的预防"><a class="markdownIt-Anchor" href="#死锁的预防"></a> 死锁的预防</h2><ul><li><p>产生死锁的原因是两个或多个事务都已封锁了一些数据对象，然后又都请求对已为其他事务封锁的数据对象加锁，从而出现死等待。</p></li><li><p>预防死锁的发生就是要破坏产生死锁的条件</p></li><li><p><strong>一次封锁法</strong>，要求每个事务必须一次将所有要使用的数据全部加锁，否则就不能继续执行</p></li><li><p>存在的问题</p><ul><li>降低系统并发度</li><li>难于事先精确确定封锁对象<ul><li>数据库中数据是不断变化的，原来不要求封锁的数据，在执行过程中可能会变成封锁对象，所以很难事先精确地确定每个事务所要封锁的数据对象。</li><li>解决方法：将事务在执行过程中可能要封锁的数据对象全部加锁，这就进一步降低了并发度。</li></ul></li></ul></li><li><p><strong>顺序封锁法</strong>，预先对数据对象规定一个封锁顺序，所有事务都按这个顺序实行封锁。</p></li><li><p>存在的问题</p><ul><li>维护成本<ul><li>数据库系统中封锁的数据对象极多，并且随数据的插入、删除等操作而不断地变化，要维护这样的资源的封锁顺序非常困难，成本很高。</li></ul></li><li>难以实现<ul><li>事务的封锁请求可以随着事务的执行而动态地决定，很难事先确定每一个事务要封锁哪些对象，因此也就很难按规定的顺序去施加封锁</li></ul></li></ul></li></ul><h2 id="死锁的诊断"><a class="markdownIt-Anchor" href="#死锁的诊断"></a> 死锁的诊断</h2><ul><li><p>数据库管理系统在解决死锁的问题上更普遍采用的是诊断并解除死锁的方法</p><ul><li>在操作系统中广为采用的预防死锁的策略并不太适合数据库的特点</li></ul></li><li><p><strong>超时法</strong>，如果一个事务的等待时间超过了规定的时限，就认为发生了死锁</p></li><li><p>优点</p><ul><li>实现简单</li></ul></li><li><p>缺点</p><ul><li>有可能误判死锁</li><li>时限若设置得太长，死锁发生后不能及时发现</li></ul></li><li><p><strong>等待图法</strong>，并发控制子系统周期性地（比如每隔数秒）生成事务等待图，检测事务。如果发现图中存在回路，则表示系统中出现了死锁。</p><ul><li>事务等待图是一个有向图G=(T，U)</li><li>T为结点的集合，每个结点表示正运行的事务</li><li>U为边的集合，每条边表示事务等待的情况</li><li>若T1等待T2 ，则T1 ， T2之间划一条有向边，从T1指向T2</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/26/U8nF5p9wKP3S7Vd.png" alt="image-20220426151508874"></p><h2 id="死锁的解除"><a class="markdownIt-Anchor" href="#死锁的解除"></a> 死锁的解除</h2><ul><li><p>解除死锁</p><ul><li>选择一个处理死锁代价最小的事务，将其撤消</li><li>释放此事务持有的所有的锁，使其它事务能继续运行下去</li></ul></li></ul><h1 id="ch-56-事务调度"><a class="markdownIt-Anchor" href="#ch-56-事务调度"></a> ch 56 事务调度</h1><h2 id="并发调度的可串行性"><a class="markdownIt-Anchor" href="#并发调度的可串行性"></a> 并发调度的可串行性</h2><ul><li>数据库管理系统对并发事务不同的调度可能会产生不同的结果</li><li>串行调度是正确的</li><li>执行结果等价于串行调度的调度也是正确的，称为可串行化调度</li></ul><h2 id="可串行化调度"><a class="markdownIt-Anchor" href="#可串行化调度"></a> 可串行化调度</h2><ul><li>可串行化(Serializable)调度<ul><li>多个事务的并发执行是正确的，当且仅当其结果与按某一次序串行地执行这些事务时的结果相同</li></ul></li><li>可串行性(Serializability)<ul><li>是并发事务正确调度的准则</li><li>一个给定的并发调度，当且仅当它是可串行化的，才认为是正确调度</li></ul></li></ul><h2 id="可串行化调度的例子"><a class="markdownIt-Anchor" href="#可串行化调度的例子"></a> 可串行化调度的例子</h2><p><img src="https://s2.loli.net/2022/04/26/lFCgPjcI9xhDu12.png" alt="image-20220426151702617"></p><h2 id="串行调度正确的调度"><a class="markdownIt-Anchor" href="#串行调度正确的调度"></a> 串行调度,正确的调度</h2><p><strong>串行调度(a)</strong></p><p><img src="https://s2.loli.net/2022/04/26/1Pk6gZCvWRFGcba.png" alt="image-20220426151724290"></p><ul><li>假设A、B的初值均为2。</li><li>按T1→T2次序执行结果为A=3，B=4</li><li>串行调度策略,正确的调度</li></ul><p><strong>串行调度(b)</strong></p><p><img src="https://s2.loli.net/2022/04/26/9bBTVozWeG7k1Hl.png" alt="image-20220426151825547"></p><ul><li>假设A、B的初值均为2。</li><li>T2→T1次序执行结果为B=3，A=4</li><li>串行调度策略,正确的调度</li></ul><h2 id="不可串行化调度错误的调度"><a class="markdownIt-Anchor" href="#不可串行化调度错误的调度"></a> 不可串行化调度，错误的调度</h2><p><img src="https://s2.loli.net/2022/04/26/2bICqiJK6wV95s1.png" alt="image-20220426152010292"></p><ul><li>执行结果与(a)、(b)的结果都不同</li><li>是错误的调度</li></ul><h2 id="可串行化调度正确的调度"><a class="markdownIt-Anchor" href="#可串行化调度正确的调度"></a> 可串行化调度，正确的调度</h2><p><img src="https://s2.loli.net/2022/04/26/SCFbhjAHXDO8TxE.png" alt="image-20220426152048148"></p><ul><li>执行结果与串行调度(a)的执行结果相同</li><li>是正确的调度</li></ul><h2 id="冲突可串行化"><a class="markdownIt-Anchor" href="#冲突可串行化"></a> 冲突可串行化</h2><p><strong>冲突可串行化 1</strong></p><ul><li><p>冲突可串行化</p><ul><li>一个比可串行化更严格的条件</li><li>商用系统中的调度器采用</li></ul></li><li><p>冲突操作：是指不同的事务对同一数据的读写操作和写写操作：</p><p><img src="https://s2.loli.net/2022/04/29/46uAF3UByZ5wrg8.png" alt=""></p></li><li><p>其他操作是不冲突操作</p></li><li><p>不能交换（Swap）的动作:</p><ul><li>同一事务的两个操作</li><li>不同事务的冲突操作</li></ul></li></ul><p><strong>冲突可串行化 2</strong></p><ul><li>一个调度Sc在保证冲突操作的次序不变的情况下，通过交换两个事务不冲突操作的次序得到另一个调度Sc’，如果Sc’是串行的，称调度Sc是冲突可串行化的调度</li><li>若一个调度是冲突可串行化，则一定是可串行化的调度</li><li>可用这种方法判断一个调度是否是冲突可串行化的</li></ul><p><strong>冲突可串行化 3</strong></p><p><img src="https://s2.loli.net/2022/04/29/EtBPd4hYM3js7J1.png" alt=""></p><h2 id="冲突可串行化调度"><a class="markdownIt-Anchor" href="#冲突可串行化调度"></a> 冲突可串行化调度</h2><ul><li><p>冲突可串行化调度是可串行化调度的充分条件，不是必要条件。还有不满足冲突可串行化条件的可串行化调度。</p><p><img src="https://s2.loli.net/2022/04/29/vMATEcIK4g2e9t1.png" alt=""></p></li></ul><h2 id="两段锁协议"><a class="markdownIt-Anchor" href="#两段锁协议"></a> 两段锁协议</h2><p><strong>两段锁协议 1</strong></p><ul><li>数据库管理系统普遍采用两段锁协议的方法实现并发调度的可串行性，从而保证调度的正确性</li><li>两段锁协议，指所有事务必须分两个阶段对数据项加锁和解锁<ul><li>在对任何数据进行读、写操作之前，事务首先要获得对该数据的封锁</li><li>在释放一个封锁之后，事务不再申请和获得任何其他封锁</li></ul></li></ul><p><strong>两段锁协议 2</strong></p><ul><li>“两段”锁的含义，事务分为两个阶段<ul><li>第一阶段是获得封锁，也称为扩展阶段<br>事务可以申请获得任何数据项上的任何类型的锁，但是不能释放任何锁</li><li>第二阶段是释放封锁，也称为收缩阶段<br>事务可以释放任何数据项上的任何类型的锁，但是不能再申请任何锁</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/29/qx4XrcZHCmBNjDU.png" alt=""></p><p><strong>两段锁协议 3</strong></p><p><img src="https://s2.loli.net/2022/04/29/5NqIB4XZMwFT6yp.png" alt=""></p><ul><li>上图的调度是遵守两段锁协议的，因此一定是一个可串行化调度。</li><li>如何验证？</li></ul><p><strong>两段锁协议 4</strong></p><ul><li>事务遵守两段锁协议是可串行化调度的充分条件，而不是必要条件。</li><li>若并发事务都遵守两段锁协议，则对这些事务的任何并发调度策略都是可串行化的</li><li>若并发事务的一个调度是可串行化的，不一定所有事务都符合两段锁协议</li></ul><p><strong>两段锁协议 5</strong></p><ul><li>两段锁协议与防止死锁的一次封锁法<ul><li>一次封锁法要求每个事务必须一次将所有要使用的数据全部加锁，否则就不能继续执行，因此一次封锁法遵守两段锁协议</li><li>但是两段锁协议并不要求事务必须一次将所有要使用的数据全部加锁，因此遵守两段锁协议的事务可能发生死锁</li></ul></li></ul><p><strong>两段锁协议 6</strong></p><p><img src="https://s2.loli.net/2022/04/29/IGLJQKg6Ezkoexr.png" alt=""></p><h1 id="ch-57-封锁粒度"><a class="markdownIt-Anchor" href="#ch-57-封锁粒度"></a> ch 57 封锁粒度</h1><h2 id="封锁粒度"><a class="markdownIt-Anchor" href="#封锁粒度"></a> 封锁粒度</h2><ul><li>封锁对象的大小称为封锁粒度(Granularity)</li><li>封锁的对象:逻辑单元，物理单元</li><li>例：在关系数据库中，封锁对象：<ul><li>逻辑单元: 属性值、属性值的集合、元组、关系、索引项、整个索引、整个数据库等</li><li>物理单元：页（数据页或索引页）、物理记录等</li></ul></li></ul><h2 id="选择封锁粒度原则"><a class="markdownIt-Anchor" href="#选择封锁粒度原则"></a> 选择封锁粒度原则</h2><ul><li>封锁粒度与系统的并发度和并发控制的开销密切相关。<ul><li>封锁的粒度越大，数据库所能够封锁的数据单元就越少，并发度就越小，系统开销也越小；</li><li>封锁的粒度越小，并发度较高，但系统开销也就越大</li></ul></li><li>例<ul><li>若封锁粒度是数据页，事务T1需要修改元组L1，则T1必须对包含L1的整个数据页A加锁。如果T1对A加锁后事务T2要修改A中元组L2，则T2被迫等待，直到T1释放A。</li><li>如果封锁粒度是元组，则T1和T2可以同时对L1和L2加锁，不需要互相等待，提高了系统的并行度。</li></ul></li><li>又如，事务T需要读取整个表，若封锁粒度是元组，T必须对表中的每一个元组加锁，开销极大</li></ul><h2 id="多粒度封锁"><a class="markdownIt-Anchor" href="#多粒度封锁"></a> 多粒度封锁</h2><ul><li>多粒度封锁(Multiple Granularity Locking)<ul><li>在一个系统中同时支持多种封锁粒度供不同的事务选择</li></ul></li><li>选择封锁粒度，同时考虑封锁开销和并发度两个因素, 适当选择封锁粒度<ul><li>需要处理多个关系的大量元组的用户事务：以数据库为封锁单位</li><li>需要处理大量元组的用户事务：以关系为封锁单元</li><li>只处理少量元组的用户事务：以元组为封锁单位</li></ul></li></ul><h2 id="多粒度树"><a class="markdownIt-Anchor" href="#多粒度树"></a> 多粒度树</h2><ul><li>多粒度树<ul><li>以树形结构来表示多级封锁粒度</li><li>根结点是整个数据库，表示最大的数据粒度</li><li>叶结点表示最小的数据粒度</li></ul></li><li>例：三级粒度树。根结点为数据库，数据库的子结点为关系，关系的子结点为元组。</li></ul><h2 id="多粒度封锁协议"><a class="markdownIt-Anchor" href="#多粒度封锁协议"></a> 多粒度封<img src="https://s2.loli.net/2022/04/29/aVUkTlsKNyAROtQ.png" alt="">锁协议</h2><ul><li>允许多粒度树中的每个结点被独立地加锁</li><li>对一个结点加锁意味着这个结点的所有后裔结点也被加以同样类型的锁</li><li>在多粒度封锁中一个数据对象可能以两种方式封锁：<ul><li>显式封锁: 直接加到数据对象上的封锁</li><li>隐式封锁:是该数据对象没有独立加锁，是由于其上级结点加锁而使该数据对象加上了锁</li></ul></li><li>显式封锁和隐式封锁的效果是一样的</li></ul><h2 id="显式封锁和隐式封锁"><a class="markdownIt-Anchor" href="#显式封锁和隐式封锁"></a> 显式封锁和隐式封锁</h2><p><strong>显式封锁和隐式封锁 1</strong></p><ul><li>系统检查封锁冲突时<ul><li>要检查显式封锁</li><li>还要检查隐式封锁</li></ul></li><li>例如，事务T要对关系R1加X锁<ul><li>系统必须搜索其上级结点数据库、关系R1</li><li>还要搜索R1的下级结点，即R1中的每一个元组</li><li>如果其中某一个数据对象已经加了不相容锁，则T必须等待</li></ul></li></ul><p><strong>显式封锁和隐式封锁 2</strong></p><ul><li>对某个数据对象加锁，系统要检查<ul><li>该数据对象</li><li>有无显式封锁与之冲突</li><li>所有上级结点</li><li>检查本事务的显式封锁是否与该数据对象上的隐式封锁冲突：(由上级结点已加的封锁造成的）</li><li>所有下级结点<ul><li>看上面的显式封锁是否与本事务的隐式封锁（将加到下级结点的封锁）冲突</li></ul></li></ul></li></ul><h2 id="意向锁"><a class="markdownIt-Anchor" href="#意向锁"></a> 意向锁</h2><ul><li>引进意向锁（intention lock）目的<ul><li>提高对某个数据对象加锁时系统的检查效率</li></ul></li><li>如果对一个结点加意向锁，则说明该结点的下层结点正在被加锁</li><li>对任一结点加基本锁，必须先对它的上层结点加意向锁</li><li>例如，对任一元组加锁时，必须先对它所在的数据库和关系加意向锁</li></ul><h3 id="常用意向锁"><a class="markdownIt-Anchor" href="#常用意向锁"></a> 常用意向锁</h3><p><strong>常用意向锁 1</strong></p><ul><li>共享意向排它锁(Share Intent Exclusive Lock，简称SIX锁)</li></ul><p><strong>常用意向锁-意向共享锁</strong></p><ul><li>意向共享锁(Intent Share Lock，简称IS锁)<ul><li>如果对一个数据对象加IS锁，表示它的后裔结点拟（意向）加S锁。</li><li>例如：事务T1要对R1中某个元组加S锁，则要首先对关系R1和数据库加IS锁</li></ul></li></ul><p><strong>常用意向锁-意向排它锁</strong></p><ul><li>意向排它锁(Intent Exclusive Lock，简称IX锁)<ul><li>如果对一个数据对象加IX锁，表示它的后裔结点拟（意向）加X锁。</li><li>例如：事务T1要对R1中某个元组加X锁，则要首先对关系R1和数据库加IX锁</li></ul></li></ul><p><strong>常用意向锁-共享意向排它锁</strong></p><ul><li>共享意向排它锁(Share Intent Exclusive Lock，简称SIX锁)<ul><li>如果对一个数据对象加SIX锁，表示对它加S锁，再加IX锁，即SIX = S + IX。</li><li>例：对某个表加SIX锁，则表示该事务要读整个表（所以要对该表加S锁），同时会更新个别元组（所以要对该表加IX锁）</li></ul></li></ul><h2 id="意向锁的相容矩阵"><a class="markdownIt-Anchor" href="#意向锁的相容矩阵"></a> 意向锁的相容矩阵</h2><p><img src="https://s2.loli.net/2022/04/29/qxBfRVH2zO1yZvI.png" alt=""></p><h2 id="锁的强度"><a class="markdownIt-Anchor" href="#锁的强度"></a> 锁的强度</h2><ul><li>锁的强度是指它对其他锁的排斥程度</li><li>一个事务在申请封锁时以强锁代替弱锁是安全的，反之则不然</li></ul><p><img src="https://s2.loli.net/2022/04/29/e3uWKnIacf2gOwA.png" alt=""></p><h2 id="具有意向锁的多粒度封锁方法"><a class="markdownIt-Anchor" href="#具有意向锁的多粒度封锁方法"></a> 具有意向锁的多粒度封锁方法</h2><ul><li><p>申请封锁时应该按自上而下的次序进行</p></li><li><p>释放封锁时则应该按自下而上的次序进行</p></li><li><p>具有意向锁的多粒度封锁方法</p><ul><li>提高了系统的并发度</li><li>减少了加锁和解锁的开销</li><li>在实际的数据库管理系统产品中得到广泛应</li></ul></li><li><p>例如：事务T1要对关系R1加S锁</p><ul><li>要首先对数据库加IS锁</li><li>检查数据库和R1是否已加了不相容的锁(X或IX)</li><li>不再需要搜索和检查R1中的元组是否加了不相容的锁(X锁)</li></ul></li></ul></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">胡小小小小睿</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://little-hurui.cloud/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/">http://little-hurui.cloud/2022/04/19/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch54-57/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://little-hurui.cloud" target="_blank">投降输一半</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/">数据管理基础</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/21/GwB7I2bi1OP3RzW.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2022/04/19/RFQ7a3WzipEBlS2.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/04/19/RFQ7a3WzipEBlS2.jpg" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://s2.loli.net/2022/04/19/faP7b2XxJlQqVrp.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/04/19/faP7b2XxJlQqVrp.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/04/22/C-%E7%BB%93%E6%9E%84%E4%BD%93/"><img class="prev-cover" src="https://s2.loli.net/2022/04/21/o2axF8K4dteI379.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">C++结构体</div></div></a></div><div class="next-post pull-right"><a href="/2022/04/18/CS144-Lab-3/"><img class="next-cover" src="https://s2.loli.net/2022/04/21/wEzBjRMteC3DFGI.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">CS144 Lab 3</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/03/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch58-61/" title="数据管理基础 ch58-61"><img class="cover" src="https://s2.loli.net/2022/04/21/cTel5CKPIaRw6Fz.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-03</div><div class="title">数据管理基础 ch58-61</div></div></a></div><div><a href="/2022/04/03/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch08-10/" title="数据管理基础 ch08-10"><img class="cover" src="https://s2.loli.net/2022/04/21/xqhitE7VdkOcJ5I.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-03</div><div class="title">数据管理基础 ch08-10</div></div></a></div><div><a href="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch32-36/" title="数据管理基础 ch32-36"><img class="cover" src="https://s2.loli.net/2022/04/21/NeOx4qCJkEDBf3F.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-14</div><div class="title">数据管理基础 ch32-36</div></div></a></div><div><a href="/2022/04/15/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch45-47/" title="数据管理基础 ch45-47"><img class="cover" src="https://s2.loli.net/2022/04/21/DCU72OZBoTvdtQm.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-15</div><div class="title">数据管理基础 ch45-47</div></div></a></div><div><a href="/2022/05/13/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-NoSQL/" title="数据管理基础 NoSQL"><img class="cover" src="https://s2.loli.net/2022/04/21/scqjKxGtHUT4kOW.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-13</div><div class="title">数据管理基础 NoSQL</div></div></a></div><div><a href="/2022/04/03/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch00-07/" title="数据管理基础 ch00-07"><img class="cover" src="https://s2.loli.net/2022/04/22/2rWZ89fL7IGPq43.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-03</div><div class="title">数据管理基础 ch00-07</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/04/20/iVOmaCTznfybv2A.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="avatar"></div><div class="author-info__name">胡小小小小睿</div><div class="author-info__description">Stay hungry Stay foolish</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">108</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Freeeeeeeeedom"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">I'm free, gone with wind.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ch-54-%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">ch 54 并发控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%B9%B6%E5%8F%91"><span class="toc-number">1.1.</span> <span class="toc-text">事务并发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E4%BA%8B%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">多事务执行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">1.3.</span> <span class="toc-text">不一致性的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%93%8D%E4%BD%9C%E5%B8%A6%E6%9D%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7"><span class="toc-number">1.4.</span> <span class="toc-text">并发操作带来的数据不一致性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%A2%E5%A4%B1%E4%BF%AE%E6%94%B9"><span class="toc-number">1.4.1.</span> <span class="toc-text">丢失修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E9%87%8D%E5%A4%8D%E8%AF%BB"><span class="toc-number">1.4.2.</span> <span class="toc-text">不可重复读</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E8%84%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.3.</span> <span class="toc-text">读“脏”数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E4%B8%8D%E4%B8%80%E8%87%B4%E6%80%A7%E5%8F%8A%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6"><span class="toc-number">1.5.</span> <span class="toc-text">数据不一致性及并发控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%E7%9A%84%E4%B8%BB%E8%A6%81%E6%8A%80%E6%9C%AF"><span class="toc-number">1.6.</span> <span class="toc-text">并发控制的主要技术</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ch-55-%E5%B0%81%E9%94%81"><span class="toc-number">2.</span> <span class="toc-text">ch 55 封锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E9%94%81"><span class="toc-number">2.1.</span> <span class="toc-text">封锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%AE%83%E9%94%81%E4%B8%8E%E5%85%B1%E4%BA%AB%E9%94%81"><span class="toc-number">2.2.</span> <span class="toc-text">排它锁与共享锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81%E7%9A%84%E7%9B%B8%E5%AE%B9%E7%9F%A9%E9%98%B5"><span class="toc-number">2.3.</span> <span class="toc-text">锁的相容矩阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.4.</span> <span class="toc-text">封锁协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.5.</span> <span class="toc-text">一级封锁协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.6.</span> <span class="toc-text">二级封锁协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%BA%A7%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.7.</span> <span class="toc-text">三级封锁协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE%E5%B0%8F%E7%BB%93"><span class="toc-number">2.8.</span> <span class="toc-text">封锁协议小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B4%BB%E9%94%81"><span class="toc-number">2.9.</span> <span class="toc-text">活锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E9%94%81"><span class="toc-number">2.10.</span> <span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E7%9A%84%E9%A2%84%E9%98%B2"><span class="toc-number">2.11.</span> <span class="toc-text">死锁的预防</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E7%9A%84%E8%AF%8A%E6%96%AD"><span class="toc-number">2.12.</span> <span class="toc-text">死锁的诊断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%BB%E9%94%81%E7%9A%84%E8%A7%A3%E9%99%A4"><span class="toc-number">2.13.</span> <span class="toc-text">死锁的解除</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ch-56-%E4%BA%8B%E5%8A%A1%E8%B0%83%E5%BA%A6"><span class="toc-number">3.</span> <span class="toc-text">ch 56 事务调度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E8%B0%83%E5%BA%A6%E7%9A%84%E5%8F%AF%E4%B8%B2%E8%A1%8C%E6%80%A7"><span class="toc-number">3.1.</span> <span class="toc-text">并发调度的可串行性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%E8%B0%83%E5%BA%A6"><span class="toc-number">3.2.</span> <span class="toc-text">可串行化调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%E8%B0%83%E5%BA%A6%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">3.3.</span> <span class="toc-text">可串行化调度的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%B2%E8%A1%8C%E8%B0%83%E5%BA%A6%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%B0%83%E5%BA%A6"><span class="toc-number">3.4.</span> <span class="toc-text">串行调度,正确的调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%E8%B0%83%E5%BA%A6%E9%94%99%E8%AF%AF%E7%9A%84%E8%B0%83%E5%BA%A6"><span class="toc-number">3.5.</span> <span class="toc-text">不可串行化调度，错误的调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%E8%B0%83%E5%BA%A6%E6%AD%A3%E7%A1%AE%E7%9A%84%E8%B0%83%E5%BA%A6"><span class="toc-number">3.6.</span> <span class="toc-text">可串行化调度，正确的调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%B2%E7%AA%81%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96"><span class="toc-number">3.7.</span> <span class="toc-text">冲突可串行化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%B2%E7%AA%81%E5%8F%AF%E4%B8%B2%E8%A1%8C%E5%8C%96%E8%B0%83%E5%BA%A6"><span class="toc-number">3.8.</span> <span class="toc-text">冲突可串行化调度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E6%AE%B5%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.9.</span> <span class="toc-text">两段锁协议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ch-57-%E5%B0%81%E9%94%81%E7%B2%92%E5%BA%A6"><span class="toc-number">4.</span> <span class="toc-text">ch 57 封锁粒度</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E9%94%81%E7%B2%92%E5%BA%A6"><span class="toc-number">4.1.</span> <span class="toc-text">封锁粒度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E5%B0%81%E9%94%81%E7%B2%92%E5%BA%A6%E5%8E%9F%E5%88%99"><span class="toc-number">4.2.</span> <span class="toc-text">选择封锁粒度原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%B2%92%E5%BA%A6%E5%B0%81%E9%94%81"><span class="toc-number">4.3.</span> <span class="toc-text">多粒度封锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%B2%92%E5%BA%A6%E6%A0%91"><span class="toc-number">4.4.</span> <span class="toc-text">多粒度树</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%B2%92%E5%BA%A6%E5%B0%81%E9%94%81%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.5.</span> <span class="toc-text">多粒度封锁协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%BE%E5%BC%8F%E5%B0%81%E9%94%81%E5%92%8C%E9%9A%90%E5%BC%8F%E5%B0%81%E9%94%81"><span class="toc-number">4.6.</span> <span class="toc-text">显式封锁和隐式封锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%90%91%E9%94%81"><span class="toc-number">4.7.</span> <span class="toc-text">意向锁</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%84%8F%E5%90%91%E9%94%81"><span class="toc-number">4.7.1.</span> <span class="toc-text">常用意向锁</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%84%8F%E5%90%91%E9%94%81%E7%9A%84%E7%9B%B8%E5%AE%B9%E7%9F%A9%E9%98%B5"><span class="toc-number">4.8.</span> <span class="toc-text">意向锁的相容矩阵</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%81%E7%9A%84%E5%BC%BA%E5%BA%A6"><span class="toc-number">4.9.</span> <span class="toc-text">锁的强度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E6%9C%89%E6%84%8F%E5%90%91%E9%94%81%E7%9A%84%E5%A4%9A%E7%B2%92%E5%BA%A6%E5%B0%81%E9%94%81%E6%96%B9%E6%B3%95"><span class="toc-number">4.10.</span> <span class="toc-text">具有意向锁的多粒度封锁方法</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/16/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/" title="详细设计"><img src="https://s2.loli.net/2022/04/22/IFwDpCUGyLWnTS2.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="详细设计"></a><div class="content"><a class="title" href="/2022/05/16/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/" title="详细设计">详细设计</a><time datetime="2022-05-16T13:19:34.000Z" title="发表于 2022-05-16 21:19:34">2022-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/16/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96/" title="面向对象的模块化"><img src="https://s2.loli.net/2022/04/21/tGgWsc1apn8x6Om.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="面向对象的模块化"></a><div class="content"><a class="title" href="/2022/05/16/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96/" title="面向对象的模块化">面向对象的模块化</a><time datetime="2022-05-16T02:15:43.000Z" title="发表于 2022-05-16 10:15:43">2022-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/16/Cpp%E7%89%B9%E6%80%A7/" title="Cpp特性"><img src="https://s2.loli.net/2022/04/21/K1Zl9wtYfzMpVIJ.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="Cpp特性"></a><div class="content"><a class="title" href="/2022/05/16/Cpp%E7%89%B9%E6%80%A7/" title="Cpp特性">Cpp特性</a><time datetime="2022-05-16T01:44:04.000Z" title="发表于 2022-05-16 09:44:04">2022-05-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/15/%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6/" title="区间合并"><img src="https://s2.loli.net/2022/04/20/ecg1DWSXUEC4O3Q.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="区间合并"></a><div class="content"><a class="title" href="/2022/05/15/%E5%8C%BA%E9%97%B4%E5%90%88%E5%B9%B6/" title="区间合并">区间合并</a><time datetime="2022-05-15T04:59:55.000Z" title="发表于 2022-05-15 12:59:55">2022-05-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/14/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9DP/" title="状态压缩DP"><img src="https://s2.loli.net/2022/04/21/xho7LGY1rNv39le.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="状态压缩DP"></a><div class="content"><a class="title" href="/2022/05/14/%E7%8A%B6%E6%80%81%E5%8E%8B%E7%BC%A9DP/" title="状态压缩DP">状态压缩DP</a><time datetime="2022-05-13T16:27:24.000Z" title="发表于 2022-05-14 00:27:24">2022-05-14</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 胡小小小小睿</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>document.querySelectorAll("#article-container span.katex-display").forEach(a=>{btf.wrap(a,"div",{class:"katex-wrap"})})</script><script>function loadValine(){function n(){new Valine(Object.assign({el:"#vcomment",appId:"mhyGN57MG6G9YJ3rtTn90n4c-gzGzoHsz",appKey:"D3FU0mepwLhB8BK48kSAaOLx",avatar:"monsterid",serverURLs:"",emojiMaps:"",path:window.location.pathname,visitor:!1},null))}"function"==typeof Valine?n():getScript("https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js").then(n)}function loadOtherComment(){loadValine()}setTimeout(loadValine,0)</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>