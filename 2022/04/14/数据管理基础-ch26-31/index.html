<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>数据管理基础 ch26-31 | Freedom</title><meta name="description" content="ch 26 数据库完整性  数据库的完整性  数据的正确性  是指数据是符合现实世界语义，反映了当前实际状况的   数据的相容性  是指数据库同一对象在不同关系表中的数据是符合逻辑的   例如，  学生的学号必须唯一 性别只能是男或女 本科学生年龄的取值范围为14~50的整数 学生所选的课程必须是学校开设的课程，学生所在的院系必须是学校已成立的院系       完整性 vs.安全性  数据的完整"><meta property="og:type" content="article"><meta property="og:title" content="数据管理基础 ch26-31"><meta property="og:url" content="https://freeeeeeeeedom.gitee.io/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/index.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="ch 26 数据库完整性  数据库的完整性  数据的正确性  是指数据是符合现实世界语义，反映了当前实际状况的   数据的相容性  是指数据库同一对象在不同关系表中的数据是符合逻辑的   例如，  学生的学号必须唯一 性别只能是男或女 本科学生年龄的取值范围为14~50的整数 学生所选的课程必须是学校开设的课程，学生所在的院系必须是学校已成立的院系       完整性 vs.安全性  数据的完整"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2022/04/14/gTBRXMCfun9Whti.png"><meta property="og:image" content="https://s2.loli.net/2022/04/14/XCIZWgJbLsAaVrS.png"><meta property="article:published_time" content="2022-04-14T13:58:53.000Z"><meta property="article:modified_time" content="2022-04-14T15:34:24.823Z"><meta property="article:author" content="WhooooRui"><meta property="article:tag" content="数据管理基础"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2022/04/14/gTBRXMCfun9Whti.png"><link rel="canonical" href="https://freeeeeeeeedom.gitee.io/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/index.html"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet"><meta name="generator" content="Hexo 6.1.0"></head><body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/Freeeeeeeeedom" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">Free</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">Joker &amp; Coder</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> NanJing, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/Freeeeeeeeedom" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>靡不有初,鲜克有终</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Network/">Computer Network</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Everday/">Everday</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><span class="category-list-count">39</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/2022-Spring/" rel="tag">2022_Spring</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CS144/" rel="tag">CS144</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Leetcode/" rel="tag">Leetcode</a><span class="tag-list-count">39</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/" rel="tag">数据管理基础</a><span class="tag-list-count">7</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/2022-Spring/" style="font-size:13.33px">2022_Spring</a> <a href="/tags/CS144/" style="font-size:13px">CS144</a> <a href="/tags/Leetcode/" style="font-size:14px">Leetcode</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/" style="font-size:13.67px">数据管理基础</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">59</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled"><li><div class="item-thumb"><a href="/2022/04/18/CS144-Lab-2/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/04/18/CS144-Lab-2/" class="title">CS144 Lab 2</a></p><p class="item-date"><time datetime="2022-04-18T05:23:44.000Z" itemprop="datePublished">2022-04-18</time></p></div></li><li><div class="item-thumb"><a href="/2022/04/18/April-18th/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/Everday/">Everday</a></p><p class="item-title"><a href="/2022/04/18/April-18th/" class="title">April 18th</a></p><p class="item-date"><time datetime="2022-04-17T16:54:07.000Z" itemprop="datePublished">2022-04-18</time></p></div></li><li><div class="item-thumb"><a href="/2022/04/17/JDBC/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a></p><p class="item-title"><a href="/2022/04/17/JDBC/" class="title">JDBC</a></p><p class="item-date"><time datetime="2022-04-17T13:38:34.000Z" itemprop="datePublished">2022-04-17</time></p></div></li><li><div class="item-thumb"><a href="/2022/04/17/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a></p><p class="item-title"><a href="/2022/04/17/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98/" class="title">常见问题</a></p><p class="item-date"><time datetime="2022-04-17T05:15:27.000Z" itemprop="datePublished">2022-04-17</time></p></div></li><li><div class="item-thumb"><a href="/2022/04/17/%E6%9E%84%E9%80%A0/" class="thumb"><span class="thumb-image thumb-none"></span></a></div><div class="item-inner"><p class="item-category"><a class="category-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a></p><p class="item-title"><a href="/2022/04/17/%E6%9E%84%E9%80%A0/" class="title">构造</a></p><p class="item-date"><time datetime="2022-04-17T05:15:18.000Z" itemprop="datePublished">2022-04-17</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="posts-数据管理基础-ch26-31" class="article article-type-posts" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">数据管理基础 ch26-31</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/" class="article-date"><time datetime="2022-04-14T13:58:53.000Z" itemprop="datePublished">2022-04-14</time> </a></span><span class="article-category"><i class="icon icon-folder"></i> <a class="article-category-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a> </span><span class="article-tag"><i class="icon icon-tags"></i> <a class="article-tag-link-link" href="/tags/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80/" rel="tag">数据管理基础</a> </span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span> </span></span><span class="article-read hidden-xs"><i class="icon icon-eye-fill" aria-hidden="true"></i> <span id="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/" class="leancloud_visitors" data-flag-title="数据管理基础 ch26-31">0</span> </span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 4.5k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 17(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="ch-26-数据库完整性"><a class="markdownIt-Anchor" href="#ch-26-数据库完整性"></a> ch 26 数据库完整性</h1><ul><li>数据库的完整性<ul><li>数据的正确性<ul><li>是指数据是符合现实世界语义，反映了当前实际状况的</li></ul></li><li>数据的相容性<ul><li>是指数据库同一对象在不同关系表中的数据是符合逻辑的</li></ul></li><li>例如，<ul><li>学生的学号必须唯一</li><li>性别只能是男或女</li><li>本科学生年龄的取值范围为14~50的整数</li><li>学生所选的课程必须是学校开设的课程，学生所在的院系必须是学校已成立的院系</li></ul></li></ul></li></ul><h2 id="完整性-vs安全性"><a class="markdownIt-Anchor" href="#完整性-vs安全性"></a> 完整性 vs.安全性</h2><ul><li>数据的完整性<ul><li>防止数据库中存在不符合语义的数据，也就是防止数据库中存在不正确的数据</li><li>防范对象：不合语义的、不正确的数据</li></ul></li><li>数据的安全性<ul><li>保护数据库，防止恶意的破坏和非法的存取</li><li>防范对象：非法用户和非法操作</li></ul></li></ul><h2 id="完整性机制"><a class="markdownIt-Anchor" href="#完整性机制"></a> 完整性机制</h2><ul><li>提供定义完整性约束条件的机制<ul><li>完整性约束条件也称为完整性规则，是数据库中的数据必须满足的语义约束条件</li><li>SQL标准使用了一系列概念来描述完整性，包括关系模型的实体完整性、参照完整性和用户定义完整性</li><li>这些完整性一般由SQL的数据定义语言语句来实现</li></ul></li><li>提供完整性检查的方法<ul><li>数据库管理系统中检查数据是否满足完整性约束条件的机制称为完整性检查。</li><li>一般在INSERT、UPDATE、DELETE语句执行后开始检查，也可以在事务提交时检查</li></ul></li><li>违约处理<ul><li>数据库管理系统若发现用户的操作违背了完整性约束条件，就采取一定的动作<ul><li>拒绝（NO ACTION）执行该操作</li><li>级连（CASCADE）执行其他操作</li></ul></li></ul></li></ul><h1 id="ch-27-实体完整性"><a class="markdownIt-Anchor" href="#ch-27-实体完整性"></a> ch 27 实体完整性</h1><h2 id="实体完整性定义"><a class="markdownIt-Anchor" href="#实体完整性定义"></a> 实体完整性定义</h2><h3 id="实体完整性-定义1"><a class="markdownIt-Anchor" href="#实体完整性-定义1"></a> 实体完整性 定义1</h3><ul><li>关系模型的实体完整性<ul><li>CREATE TABLE中用PRIMARY KEY定义</li></ul></li><li>单属性构成的码有两种说明方法<ul><li>定义为列级约束条件</li><li>定义为表级约束条件</li></ul></li><li>对多个属性构成的码只有一种说明方法<ul><li>定义为表级约束条件</li></ul></li></ul><h3 id="实体完整性定义-2"><a class="markdownIt-Anchor" href="#实体完整性定义-2"></a> 实体完整性定义 2</h3><ul><li><p>[例5.1] 将Student表中的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性定义为码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">	(Sno <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">PRIMARY</span></span><br><span class="line">	KEY,</span><br><span class="line">		Sname <span class="type">CHAR</span>(<span class="number">20</span>) <span class="keyword">NOT</span></span><br><span class="line">	<span class="keyword">NULL</span>,</span><br><span class="line">		Ssex <span class="type">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">		Sage <span class="type">SMALLINT</span>,</span><br><span class="line">		Sdept <span class="type">CHAR</span>(<span class="number">20</span>)</span><br><span class="line">		);</span><br></pre></td></tr></table></figure></li><li><pre class="highlight"><code class="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student
	(Sno <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">9</span>),
      Sname <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">20</span>)
    	  <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
      Ssex <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">2</span>).
      Sage <span class="hljs-built_in">SMALLINT</span>,
      Sdept <span class="hljs-built_in">CHAR</span>(<span class="hljs-number">20</span>),
      PRIMARY <span class="hljs-keyword">KEY</span> (Sno)
    );
&lt;!<span class="hljs-comment">--code￼1--&gt;</span>

</code></pre></li></ul><h2 id="实体完整性检查和违约处理"><a class="markdownIt-Anchor" href="#实体完整性检查和违约处理"></a> 实体完整性检查和违约处理</h2><ul><li>插入或对主码列进行更新操作时，关系数据库管理系统按照实体完整性规则自动进行检查。包括：<ul><li>检查主码值是否唯一，如果不唯一则拒绝插入或修改</li><li>检查主码的各个属性是否为空，只要有一个为空就拒绝插入或修改</li></ul></li></ul><h2 id="实体完整性检查"><a class="markdownIt-Anchor" href="#实体完整性检查"></a> 实体完整性检查</h2><h3 id="实体完整性检查-1"><a class="markdownIt-Anchor" href="#实体完整性检查-1"></a> 实体完整性检查 1</h3><ul><li>检查记录中主码值是否唯一的一种方法是进行全表扫描<ul><li>依次判断表中每一条记录的主码值与将插入记录上的主码值（或者修改的新主码值）是否相同</li><li>十分耗时</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/14/gTBRXMCfun9Whti.png" alt="image-20220321200358399"></p><h3 id="实体完整性检查-2"><a class="markdownIt-Anchor" href="#实体完整性检查-2"></a> 实体完整性检查 2</h3><ul><li>为避免对基本表进行全表扫描，RDBMS核心一般都在主码上自动建立一个索引，如B+树索引<ul><li>新插入记录的主码值是25</li><li>通过主码索引，从B+树的根结点开始查找</li><li>读取3个结点：根结点（51）、中间结点（12 30）、叶结点（15 20 25）</li><li>该主码值已经存在，不能插入这条记录</li></ul></li></ul><p><img src="https://s2.loli.net/2022/04/14/XCIZWgJbLsAaVrS.png" alt="image-20220321200354694"></p><h1 id="ch-28-参照完整性"><a class="markdownIt-Anchor" href="#ch-28-参照完整性"></a> ch 28 参照完整性</h1><h2 id="参照完整性定义"><a class="markdownIt-Anchor" href="#参照完整性定义"></a> 参照完整性定义</h2><ul><li><p>关系模型的参照完整性定义</p><ul><li>在CREATE TABLE中用FOREIGN KEY短语定义哪些列为外码</li><li>用REFERENCES短语指明这些外码参照哪些表的主码</li></ul></li><li><p>[例5.3]定义SC中的参照完整性</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SC</span><br><span class="line">(Sno <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> Cno <span class="type">CHAR</span>($) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> Grade <span class="type">SMALLINT</span>,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY(Sno,Cno),</span><br><span class="line"> 	<span class="keyword">FOREIGN</span> KEY(Sno) <span class="keyword">REFERENCES</span> Student(Sno),</span><br><span class="line"> 	<span class="keyword">FOREIGN</span> KEY(Sno) <span class="keyword">REFERENCES</span> Course(Cno)</span><br><span class="line"> 	);</span><br></pre></td></tr></table></figure></li></ul><h2 id="参照完整性检查"><a class="markdownIt-Anchor" href="#参照完整性检查"></a> 参照完整性检查</h2><h3 id="参照完整性定义-1"><a class="markdownIt-Anchor" href="#参照完整性定义-1"></a> 参照完整性定义 1</h3><ul><li>一个参照完整性将两个表中的相应元组联系起来</li><li>对被参照表和参照表进行增删改操作时有可能破坏参照完整性，必须进行检查</li><li>例如，对表SC和Student有四种可能破坏参照完整性的情况 :<ul><li>SC表中增加一个元组，该元组的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值在表Student中找不到一个元组，其<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值与之相等。</li><li>修改SC表中的一个元组，修改后该元组的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值在表Student中找不到一个元组，其<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值与之相等。</li><li>从Student表中删除一个元组，造成SC表中某些元组的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值在表Student中找不到一个元组，其<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值与之相等。</li><li>修改Student表中一个元组的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性，造成SC表中某些元组的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值在表Student中找不到一个元组，其<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>属性的值与之相等 。</li></ul></li></ul><h3 id="参照完整性定义-2"><a class="markdownIt-Anchor" href="#参照完整性定义-2"></a> 参照完整性定义 2</h3><table><thead><tr><th>被参照表（例如Student）</th><th>参照表（例如<strong>SC）</strong></th><th>违约处理</th></tr></thead><tbody><tr><td><strong>可能破坏参照完整性</strong></td><td><strong>插入元组</strong></td><td><strong>拒绝</strong></td></tr><tr><td><strong>可能破坏参照完整性</strong></td><td><strong>修改外码值</strong></td><td><strong>拒绝</strong></td></tr><tr><td><strong>删除元组</strong></td><td><strong>可能破坏参照完整性</strong></td><td><strong>拒绝</strong>/级连删除/设置为空值</td></tr><tr><td><strong>修改主码值</strong></td><td><strong>可能破坏参照完整性</strong></td><td><strong>拒绝</strong>/级连修改/设置为空值</td></tr></tbody></table><h2 id="参照完整性违约处理"><a class="markdownIt-Anchor" href="#参照完整性违约处理"></a> 参照完整性违约处理</h2><h3 id="参照完整性违约处理-1"><a class="markdownIt-Anchor" href="#参照完整性违约处理-1"></a> 参照完整性违约处理 1</h3><ul><li>参照完整性违约处理<ul><li>拒绝（NO ACTION）执行<ul><li>不允许该操作执行。该策略一般设置为默认策略</li></ul></li><li>级联（CASCADE）操作<ul><li>当删除或修改被参照表（Student）的一个元组造成了与参照表（SC）的不一致，则删除或修改参照表中的所有造成不一致的元组</li></ul></li><li>设置为空值（SET-NULL）<ul><li>当删除或修改被参照表的一个元组时造成了不一致，则将参照表中的所有造成不一致的元组的对应属性设置为空值。</li><li>对于参照完整性，除了应该定义外码，还应定义外码列是否允许空值</li></ul></li></ul></li></ul><h3 id="参照完整性违约处理-2"><a class="markdownIt-Anchor" href="#参照完整性违约处理-2"></a> 参照完整性违约处理 2</h3><ul><li><p>例如，有下面2个关系<br>学生（学号，姓名，性别，专业号，年龄）<br>专业（专业号，专业名）</p><ul><li>假设专业表中某个元组被删除，专业号为12</li><li>按照设置为空值的策略，就要把学生表中专业号=12的所有元组的专业号设置为空值</li><li>对应语义：某个专业删除了，该专业的所有学生专业未定，等待重新分配专业</li></ul></li><li><p>[例5.4] 显式说明参照完整性的违约处理示例</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SC</span><br><span class="line">   (  Sno   <span class="type">CHAR</span>(<span class="number">9</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span>，</span><br><span class="line">           Cno   <span class="type">CHAR</span>(<span class="number">4</span>)  <span class="keyword">NOT</span> <span class="keyword">NULL</span>，</span><br><span class="line">           Grade  <span class="type">SMALLINT</span>,</span><br><span class="line">           <span class="keyword">PRIMARY</span> KEY(Sno,Cno)， 			</span><br><span class="line">           <span class="keyword">FOREIGN</span> KEY (Sno) <span class="keyword">REFERENCES</span> Student(Sno) </span><br><span class="line">	<span class="keyword">ON</span> <span class="keyword">DELETE</span> CASCADE        <span class="comment">/*级联删除SC表中相应的元组*/</span></span><br><span class="line">             	<span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE,      <span class="comment">/*级联更新SC表中相应的元组*/</span></span><br><span class="line">           <span class="keyword">FOREIGN</span> KEY (Cno) <span class="keyword">REFERENCES</span> Course(Cno)	                    </span><br><span class="line">             	<span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">NO</span> ACTION 	</span><br><span class="line">                 <span class="comment">/*当删除course 表中的元组造成了与SC表不一致时拒绝删除*/</span></span><br><span class="line">             	<span class="keyword">ON</span> <span class="keyword">UPDATE</span> CASCADE   </span><br><span class="line">      	  <span class="comment">/*当更新course表中的cno时，级联更新SC表中相应的元组*/</span></span><br><span class="line">           );</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h1 id="ch-29-用户定义的完整性"><a class="markdownIt-Anchor" href="#ch-29-用户定义的完整性"></a> ch 29 用户定义的完整性</h1><h2 id="用户定义的完整性"><a class="markdownIt-Anchor" href="#用户定义的完整性"></a> 用户定义的完整性</h2><ul><li><p>用户定义的完整性是：针对某一具体应用的数据必须满足的语义要求</p><ul><li>属性上的约束条件</li><li>元组上的约束条件<ul><li>同属性值限制相比，元组级的限制可以设置不同属性之间的取值的相互约束条件</li></ul></li></ul></li><li><p>关系数据库管理系统提供了定义和检验用户定义完整性的机制，不必由应用程序承担</p><ul><li>插入元组或修改属性的值时，关系数据库管理系统检查约束条件是否被满足</li><li>如果不满足则操作被拒绝执行</li></ul></li><li><p>列值非空</p><ul><li><p>[例5.5] 在定义SC表时，说明<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Cno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.07153em">C</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Grade</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.69444em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit">G</span><span class="mord mathit" style="margin-right:.02778em">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span>属性不允许取空值</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> SC</span><br><span class="line">(Sno <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Cno <span class="type">CHAR</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">Grade SAMLLINT <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (Sno,Cno),</span><br><span class="line">...</span><br><span class="line"><span class="comment">/* 如果在表级定义实体完整性，隐含了Sno，Cno不允许取空值，则在  </span></span><br><span class="line"><span class="comment">             列级不允许取空值的定义 可以不写 * /</span></span><br><span class="line"><span class="comment">)</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>列值唯一</p></li><li><p>[例5.6]建立部门表DEPT，要求部门名称<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Dname</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.02778em">D</span><span class="mord mathit">n</span><span class="mord mathit">a</span><span class="mord mathit">m</span><span class="mord mathit">e</span></span></span></span>列取值唯一，部门编号<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>D</mi><mi>e</mi><mi>p</mi><mi>t</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Deptno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.02778em">D</span><span class="mord mathit">e</span><span class="mord mathit">p</span><span class="mord mathit">t</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>列为主码</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> DEPT</span><br><span class="line">(Deptno <span class="type">NUMERIC</span>(<span class="number">2</span>),</span><br><span class="line">Dname <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">UNIQUE</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> <span class="comment">/*要求Dname列值唯一, 并且不能取空值*/</span></span><br><span class="line">Location <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (Deptno)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="列值是否满足条件表达式-1"><a class="markdownIt-Anchor" href="#列值是否满足条件表达式-1"></a> 列值是否满足条件表达式 1</h4><ul><li><p>用CHECK短语指定列值应该满足的条件</p></li><li><p>[例5.7] Student表的<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>s</mi><mi>e</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">Ssex</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">s</span><span class="mord mathit">e</span><span class="mord mathit">x</span></span></span></span>只允许取“男”或“女”。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">         ( Sno  <span class="type">CHAR</span>(<span class="number">9</span>) <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">           Sname <span class="type">CHAR</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,                     </span><br><span class="line">           Ssex  <span class="type">CHAR</span>(<span class="number">2</span>)  <span class="keyword">CHECK</span> （Ssex <span class="keyword">IN</span> （‘男’,’女’）），           </span><br><span class="line">           <span class="comment">/*性别属性Ssex只允许取&#x27;男&#x27;或&#x27;女&#x27; */</span></span><br><span class="line">           Sage  <span class="type">SMALLINT</span>,</span><br><span class="line">           Sdept  <span class="type">CHAR</span>(<span class="number">20</span>)</span><br><span class="line">         );</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li></ul><h4 id="列值是否满足条件表达式-2"><a class="markdownIt-Anchor" href="#列值是否满足条件表达式-2"></a> 列值是否满足条件表达式 2</h4></li><li><p>[例5.8] SC表的Grade的值应该在0和100之间</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  SC</span><br><span class="line">        (  Sno     <span class="type">CHAR</span>(<span class="number">9</span>) ,</span><br><span class="line">           Cno    <span class="type">CHAR</span>(<span class="number">4</span>),</span><br><span class="line">Grade   <span class="type">SMALLINT</span> <span class="keyword">CHECK</span> (Grade<span class="operator">&gt;=</span><span class="number">0</span> <span class="keyword">AND</span> Grade <span class="operator">&lt;=</span><span class="number">100</span>)，			      <span class="comment">/*Grade取值范围是0到100*/</span></span><br><span class="line">           <span class="keyword">PRIMARY</span> KEY (Sno,Cno),</span><br><span class="line">           <span class="keyword">FOREIGN</span> KEY (Sno) <span class="keyword">REFERENCES</span> Student(Sno),</span><br><span class="line">           <span class="keyword">FOREIGN</span> KEY (Cno) <span class="keyword">REFERENCES</span> Course(Cno)</span><br><span class="line">          );</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li></ul><h4 id="元组上约束条件的定义"><a class="markdownIt-Anchor" href="#元组上约束条件的定义"></a> 元组上约束条件的定义</h4><ul><li><p>[例5.9]当学生的性别是男时，其名字不能以Ms.打头</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">        (  Sno    <span class="type">CHAR</span>(<span class="number">9</span>), </span><br><span class="line">           Sname  <span class="type">CHAR</span>(<span class="number">8</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>，</span><br><span class="line">           Ssex    <span class="type">CHAR</span>(<span class="number">2</span>),</span><br><span class="line">           Sage   <span class="type">SMALLINT</span>,</span><br><span class="line">           Sdept  <span class="type">CHAR</span>(<span class="number">20</span>),</span><br><span class="line">           <span class="keyword">PRIMARY</span> KEY (Sno),</span><br><span class="line">           <span class="keyword">CHECK</span> (Ssex<span class="operator">=</span><span class="string">&#x27;女&#x27;</span> <span class="keyword">OR</span> Sname <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">&#x27;Ms.%&#x27;</span>)</span><br><span class="line">                  <span class="comment">/*定义了元组中Sname和 Ssex两个属性值之间的约束条件*/</span></span><br><span class="line">         );</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li></ul><h4 id="完整性约束命名子句"><a class="markdownIt-Anchor" href="#完整性约束命名子句"></a> 完整性约束命名子句</h4><ul><li>创建完整性约束<ul><li>完整性约束命名子句<ul><li>CONSTRAINT &lt;完整性约束条件名&gt;&lt;完整性约束条件&gt;</li><li>&lt;完整性约束条件&gt;包括NOT NULL、UNIQUE、PRIMARY KEY短语、FOREIGN KEY短语、CHECK短语等</li></ul></li></ul></li><li>修改完整性约束<ul><li>使用ALTER TABLE语句修改表中的完整性限制</li></ul></li></ul><h2 id="创建完整性约束"><a class="markdownIt-Anchor" href="#创建完整性约束"></a> 创建完整性约束</h2><h3 id="创建完整性约束-1"><a class="markdownIt-Anchor" href="#创建完整性约束-1"></a> 创建完整性约束 1</h3><ul><li><p>[例5.10]建立学生登记表Student，要求学号在90000~99999之间，姓名不能取空值，年龄小于30，性别只能是“男”或“女”。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">    (   Sno  <span class="type">NUMERIC</span>(<span class="number">6</span>)</span><br><span class="line">        <span class="keyword">CONSTRAINT</span> C1 <span class="keyword">CHECK</span> (Sno <span class="keyword">BETWEEN</span> <span class="number">90000</span> <span class="keyword">AND</span> <span class="number">99999</span>),</span><br><span class="line">        Sname  <span class="type">CHAR</span>(<span class="number">20</span>)  </span><br><span class="line">        <span class="keyword">CONSTRAINT</span> C2 <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">        Sage  <span class="type">NUMERIC</span>(<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">CONSTRAINT</span> C3 <span class="keyword">CHECK</span> (Sage <span class="operator">&lt;</span> <span class="number">30</span>),</span><br><span class="line">        Ssex  <span class="type">CHAR</span>(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">CONSTRAINT</span> C4 <span class="keyword">CHECK</span> (Ssex <span class="keyword">IN</span> ( ‘男’,<span class="string">&#x27;女&#x27;</span>)),</span><br><span class="line">        <span class="keyword">CONSTRAINT</span> StudentKey <span class="keyword">PRIMARY</span> KEY(Sno)</span><br><span class="line">      );</span><br></pre></td></tr></table></figure></li><li><p>在Student表上建立了5个约束条件，包括主码约束（命名为<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>t</mi><mi>u</mi><mi>d</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>K</mi><mi>e</mi><mi>y</mi></mrow><annotation encoding="application/x-tex">StudentKey</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">t</span><span class="mord mathit">u</span><span class="mord mathit">d</span><span class="mord mathit">e</span><span class="mord mathit">n</span><span class="mord mathit">t</span><span class="mord mathit" style="margin-right:.07153em">K</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:.03588em">y</span></span></span></span>）以及<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mn>1</mn></mrow><annotation encoding="application/x-tex">C1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.07153em">C</span><span class="mord mathrm">1</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">C2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.07153em">C</span><span class="mord mathrm">2</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">C3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.07153em">C</span><span class="mord mathrm">3</span></span></span></span>、C4四个列级约束。</p></li></ul><h3 id="创建完整性约束-2"><a class="markdownIt-Anchor" href="#创建完整性约束-2"></a> 创建完整性约束 2</h3><ul><li><p>[例5.11]建立教师表TEACHER，要求每个教师的应发工资不低于3000元。应发工资是工资列Sal与扣除项Deduct之和。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> TEACHER</span><br><span class="line">              (   Eno    <span class="type">NUMERIC</span>(<span class="number">4</span>)  <span class="keyword">PRIMARY</span> KEY    <span class="comment">/*在列级定义主码*/</span></span><br><span class="line">                  Ename  <span class="type">CHAR</span>(<span class="number">10</span>),</span><br><span class="line">                  Job     <span class="type">CHAR</span>(<span class="number">8</span>),</span><br><span class="line"> 		      Sal     <span class="type">NUMERIC</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> 		      Deduct  <span class="type">NUMERIC</span>(<span class="number">7</span>,<span class="number">2</span>),</span><br><span class="line"> 		      Deptno  <span class="type">NUMERIC</span>(<span class="number">2</span>),</span><br><span class="line">  		      <span class="keyword">CONSTRAINT</span> TEACHERFKey <span class="keyword">FOREIGN</span> KEY (Deptno) 		  <span class="keyword">REFERENCES</span> DEPT(Deptno),</span><br><span class="line">  		      <span class="keyword">CONSTRAINT</span> C1 <span class="keyword">CHECK</span> (Sal <span class="operator">+</span> Deduct <span class="operator">&gt;=</span> <span class="number">3000</span>) </span><br><span class="line">                );</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h2 id="修改完整性约束"><a class="markdownIt-Anchor" href="#修改完整性约束"></a> 修改完整性约束</h2><ul><li><p>[例5.12]去掉例5.10 Student表中对性别的限制。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Student </span><br><span class="line">       <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> C4;</span><br></pre></td></tr></table></figure></li><li><p>[例5.13] 修改表Student中的约束条件，要求学号改为在900000~999999之间，年龄由小于30改为小于40</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">        <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> C1;</span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">        <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> C1 <span class="keyword">CHECK</span> (Sno <span class="keyword">BETWEEN</span> <span class="number">900000</span> <span class="keyword">AND</span> <span class="number">999999</span>),</span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">        <span class="keyword">DROP</span> <span class="keyword">CONSTRAINT</span> C3;</span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> Student</span><br><span class="line">        <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> C3 <span class="keyword">CHECK</span>(Sage <span class="operator">&lt;</span> <span class="number">40</span>);</span><br></pre></td></tr></table></figure></li></ul><h1 id="ch-30-断言"><a class="markdownIt-Anchor" href="#ch-30-断言"></a> ch 30 断言</h1><ul><li>SQL中，可以使用 CREATE ASSERTION语句，通过声明性断言来指定更具一般性的约束。</li><li>可以定义涉及多个表的或聚集操作的比较复杂的完整性约束。</li><li>断言创建以后，任何对断言中所涉及的关系的操作都会触发关系数据库管理系统对断言的检查，任何使断言不为真值的操作都会被拒绝执行</li><li>如果断言很复杂，则系统在检测和维护断言的开销较高，这是在使用断言时应该注意的</li></ul><h2 id="断言相关语句"><a class="markdownIt-Anchor" href="#断言相关语句"></a> 断言相关语句</h2><ul><li><p>创建断言的语句格式</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ASSERTION<span class="operator">&lt;</span>断言名<span class="operator">&gt;</span><span class="operator">&lt;</span><span class="keyword">CHECK</span> 子句<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><ul><li>每个断言都被赋予一个名字，&lt;CHECK 子句&gt;中的约束条件与WHERE子句的条件表达式类似。</li></ul></li><li><p>删除断言的语句格式</p><ul><li><pre class="highlight"><code class="sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">ASSERTION</span> &lt;断言名&gt;；
&lt;!<span class="hljs-comment">--code￼14--&gt;</span>

</code></pre></li></ul></li></ul><h3 id="创建断言-2"><a class="markdownIt-Anchor" href="#创建断言-2"></a> 创建断言 2</h3><ul><li><p>[例5.19]限制每一门课程最多60名学生选修</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> ASSERTION ASSE_SC_CNUM1</span><br><span class="line">	<span class="keyword">CHECK</span>(<span class="number">60</span> <span class="operator">&gt;=</span> <span class="keyword">ALL</span> (<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>) 					         </span><br><span class="line">                     		<span class="keyword">FROM</span>	 SC </span><br><span class="line">				          <span class="keyword">GROUP</span> <span class="keyword">by</span> cno)</span><br><span class="line">        		  );</span><br><span class="line">        		   <span class="comment">/*此断言的谓词，涉及聚集操作count 和分组函数group by的SQL语句*/</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="创建断言-3"><a class="markdownIt-Anchor" href="#创建断言-3"></a> 创建断言 3</h3><ul><li><p>[例5.20]限制每个学期每一门课程最多60名学生选修。首先需要修改SC表的模式，增加一个“学期（TERM）”属性</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> SC <span class="keyword">ADD</span> TERM <span class="type">DATE</span>;</span><br><span class="line"><span class="keyword">CREATE</span> ASSERTION ASSE_SC_CNUM2</span><br><span class="line">	 <span class="keyword">CHECK</span>(<span class="number">60</span> <span class="operator">&gt;=</span> <span class="keyword">ALL</span> (<span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="operator">*</span>)                           						<span class="keyword">FROM</span> SC</span><br><span class="line">			<span class="keyword">GROUP</span> <span class="keyword">by</span> cno,TERM)</span><br><span class="line">			);</span><br></pre></td></tr></table></figure></li></ul><h1 id="ch-31-触发器"><a class="markdownIt-Anchor" href="#ch-31-触发器"></a> ch 31 触发器</h1><h2 id="触发器"><a class="markdownIt-Anchor" href="#触发器"></a> 触发器</h2><ul><li>触发器（Trigger）是用户定义在关系表上的一类由事件驱动的特殊过程<ul><li>触发器保存在数据库服务器中</li><li>任何用户对表的增、删、改操作均由服务器自动激活相应的触发器</li><li>触发器可以实施更为复杂的检查和操作，具有更精细和更强大的数据控制能力</li></ul></li><li>不同的RDBMS产品触发器语法各不相同</li></ul><h2 id="定义触发器"><a class="markdownIt-Anchor" href="#定义触发器"></a> 定义触发器</h2><h3 id="定义触发器-1"><a class="markdownIt-Anchor" href="#定义触发器-1"></a> 定义触发器 1</h3><ul><li><p>CREATE TRIGGER语法格式</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="operator">&lt;</span>触发器名<span class="operator">&gt;</span></span><br><span class="line"> &#123;BEFORE <span class="operator">|</span> AFTER&#125; <span class="operator">&lt;</span>触发事件<span class="operator">&gt;</span> <span class="keyword">ON</span> <span class="operator">&lt;</span>表名<span class="operator">&gt;</span></span><br><span class="line">  <span class="keyword">REFERENCING</span> <span class="keyword">NEW</span><span class="operator">|</span><span class="keyword">OLD</span> <span class="type">ROW</span> <span class="keyword">AS</span><span class="operator">&lt;</span>变量<span class="operator">&gt;</span></span><br><span class="line">  <span class="keyword">FOR</span> <span class="keyword">EACH</span>  &#123;<span class="type">ROW</span> <span class="operator">|</span> STATEMENT&#125;</span><br><span class="line"> [<span class="keyword">WHEN</span> <span class="operator">&lt;</span>触发条件<span class="operator">&gt;</span>]<span class="operator">&lt;</span>触发动作体<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>触发器又叫做事件-条件-动作 （event-condition-action）规则。</p><ul><li>当特定的系统事件发生时，对规则的条件进行检查，如果条件成立则执行规则中的动作，否则不执行该动作。规则中的动作体可以很复杂，通常是一段SQL存储过程。</li></ul></li></ul><h3 id="定义触发器-2"><a class="markdownIt-Anchor" href="#定义触发器-2"></a> 定义触发器 2</h3><ul><li>表的拥有者才可以在表上创建触发器</li><li>触发器名<ul><li>触发器名可以包含模式名，也可以不包含模式名</li><li>同一模式下，触发器名必须是唯一的</li><li>触发器名和表名必须在同一模式下</li></ul></li><li>表名<ul><li>触发器只能定义在基本表上，不能定义在视图上</li><li>当基本表的数据发生变化时，将激活定义在该表上相应触发事件的触发器</li></ul></li><li>触发事件<ul><li>触发事件可以是INSERT、DELETE或UPDATE，也可以是这几个事件的组合</li><li>还可以UPDATE OF&lt;触发列，…&gt;，即进一步指明修改哪些列时激活触发器</li><li>AFTER/BEFORE是触发的时机<ul><li>AFTER表示在触发事件的操作执行之后激活触发器</li><li>BEFORE表示在触发事件的操作执行之前激活触发器</li></ul></li></ul></li><li>触发器类型<ul><li>行级触发器（FOR EACH ROW）</li><li>语句级触发器（FOR EACH STATEMENT）</li></ul></li><li>触发条件<ul><li>触发器被激活时，只有当触发条件为真时触发动作体才执行;否则触发动作体不执行。</li><li>如果省略WHEN触发条件，则触发动作体在触发器激活后立即执行</li></ul></li><li>触发动作体<ul><li>触发动作体可以是一个匿名PL/SQL过程块，也可以是对已创建存储过程的调用</li><li>如果是行级触发器，用户可以在过程体中使用NEW和OLD引用事件之后的新值和事件之前的旧值</li><li>如果是语句级触发器，则不能在触发动作体中使用NEW或OLD进行引用</li><li>如果触发动作体执行失败，激活触发器的事件就会终止执行，触发器的目标表或触发器可能影响的其他对象不发生任何变化</li></ul></li></ul><h2 id="触发器实例"><a class="markdownIt-Anchor" href="#触发器实例"></a> 触发器实例</h2><h3 id="触发器类型"><a class="markdownIt-Anchor" href="#触发器类型"></a> 触发器类型</h3><ul><li><p>例如,在例5.11的TEACHER表上创建一个AFTER UPDATE触发器，触发事件是UPDATE语句：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> TEACHER <span class="keyword">SET</span> Deptno <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure></li><li><p>假设表TEACHER有1000行</p><ul><li>如果是语句级触发器，那么执行完该语句后，出发的动作只发生一次</li><li>如果是行级触发器，触发动作将执行1000次</li></ul></li></ul><h3 id="触发器实例-1"><a class="markdownIt-Anchor" href="#触发器实例-1"></a> 触发器实例 1</h3><ul><li><p>[例5.21]当对表SC的Grade属性进行修改时，若分数增加了10%则将此次操作记录到下面表中：SC_U（<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Sno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.05764em">S</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>C</mi><mi>n</mi><mi>o</mi></mrow><annotation encoding="application/x-tex">Cno</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.68333em"></span><span class="strut bottom" style="height:.68333em;vertical-align:0"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.07153em">C</span><span class="mord mathit">n</span><span class="mord mathit">o</span></span></span></span>,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mi>l</mi><mi>d</mi><mi>g</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Oldgrade</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.02778em">O</span><span class="mord mathit" style="margin-right:.01968em">l</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:.03588em">g</span><span class="mord mathit" style="margin-right:.02778em">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span>,<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>e</mi><mi>w</mi><mi>g</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Newgrade</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.10903em">N</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:.02691em">w</span><span class="mord mathit" style="margin-right:.03588em">g</span><span class="mord mathit" style="margin-right:.02778em">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span>）其中<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mi>l</mi><mi>d</mi><mi>g</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Oldgrade</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.02778em">O</span><span class="mord mathit" style="margin-right:.01968em">l</span><span class="mord mathit">d</span><span class="mord mathit" style="margin-right:.03588em">g</span><span class="mord mathit" style="margin-right:.02778em">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span>是修改前的分数，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi><mi>e</mi><mi>w</mi><mi>g</mi><mi>r</mi><mi>a</mi><mi>d</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Newgrade</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:.69444em"></span><span class="strut bottom" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:.10903em">N</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right:.02691em">w</span><span class="mord mathit" style="margin-right:.03588em">g</span><span class="mord mathit" style="margin-right:.02778em">r</span><span class="mord mathit">a</span><span class="mord mathit">d</span><span class="mord mathit">e</span></span></span></span>是修改后的分数。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span>  SC_T		</span><br><span class="line">	AFTER <span class="keyword">UPDATE</span> <span class="keyword">OF</span> Grade <span class="keyword">ON</span> SC</span><br><span class="line">     	<span class="keyword">REFERENCING</span></span><br><span class="line">	      <span class="keyword">OLD</span> <span class="type">row</span>  <span class="keyword">AS</span>  OldTuple,</span><br><span class="line">	      <span class="keyword">NEW</span> <span class="type">row</span> <span class="keyword">AS</span>  NewTuple</span><br><span class="line">	<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> 	</span><br><span class="line">	<span class="keyword">WHEN</span> (NewTuple.Grade <span class="operator">&gt;=</span> <span class="number">1.1</span><span class="operator">*</span>OldTuple.Grade)</span><br><span class="line">	    <span class="keyword">INSERT</span> <span class="keyword">INTO</span> SC_U(Sno,Cno,OldGrade,NewGrade)  </span><br><span class="line"><span class="keyword">VALUES</span>(OldTuple.Sno,OldTuple.Cno,OldTuple.Grade,NewTuple.Grade)</span><br></pre></td></tr></table></figure></li><li><p>[例5.22] 将每次对表Student的插入操作所增加的学生个数记录到表StudentInsertLog中。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> Student_Count</span><br><span class="line">	AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> Student  </span><br><span class="line">	        <span class="comment">/*指明触发器激活的时间是在执行INSERT后*/</span>     </span><br><span class="line">	<span class="keyword">REFERENCING</span></span><br><span class="line">     	<span class="keyword">NEW</span> <span class="keyword">TABLE</span> <span class="keyword">AS</span> DELTA</span><br><span class="line">	<span class="keyword">FOR</span> <span class="keyword">EACH</span> STATEMENT  </span><br><span class="line"><span class="comment">/*语句级触发器, 即执行完INSERT语句后下面的触发动作体才执行一次*/</span></span><br><span class="line">		<span class="keyword">INSERT</span> <span class="keyword">INTO</span> StudentInsertLog (Numbers)</span><br><span class="line">   		<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> DELTA</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>[例5.23] 定义一个BEFORE行级触发器，为教师表Teacher定义完整性规则“教授的工资不得低于4000元，如果低于4000元，自动改为4000元”。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> Insert_Or_Update_Sal </span><br><span class="line">         BEFORE <span class="keyword">INSERT</span> <span class="keyword">OR</span> <span class="keyword">UPDATE</span> <span class="keyword">ON</span> Teacher  </span><br><span class="line">         			             <span class="comment">/*触发事件是插入或更新操作*/</span></span><br><span class="line">          <span class="keyword">REFERENCING</span> <span class="keyword">NEW</span> <span class="type">row</span> <span class="keyword">AS</span> newTuple</span><br><span class="line">          <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span>        <span class="comment">/*行级触发器*/</span></span><br><span class="line">          <span class="keyword">BEGIN</span>                             <span class="comment">/*定义触发动作体，是PL/SQL过程块*/</span></span><br><span class="line">             		 IF (newTuple.Job<span class="operator">=</span><span class="string">&#x27;教授&#x27;</span>) <span class="keyword">AND</span> (newTuple.Sal <span class="operator">&lt;</span> <span class="number">4000</span>) </span><br><span class="line">             	 <span class="keyword">THEN</span> newTuple.Sal :<span class="operator">=</span><span class="number">4000</span>;                </span><br><span class="line">           	 <span class="keyword">END</span> IF;</span><br><span class="line">        <span class="keyword">END</span>;            </span><br></pre></td></tr></table></figure></li></ul><h4 id="激活触发器"><a class="markdownIt-Anchor" href="#激活触发器"></a> 激活触发器</h4><ul><li>触发器的执行，是由触发事件激活的，并由数据库服务器自动执行</li><li>一个数据表上可能定义了多个触发器，遵循如下的执行顺序:<ul><li>执行该表上的BEFORE触发器;</li><li>激活触发器的SQL语句;</li><li>执行该表上的AFTER触发器。</li></ul></li></ul><h4 id="删除触发器"><a class="markdownIt-Anchor" href="#删除触发器"></a> 删除触发器</h4><ul><li>删除触发器的SQL语法：<ul><li>DROP TRIGGER &lt;触发器名&gt; ON &lt;表名&gt;;</li></ul></li><li>触发器必须是一个已经创建的触发器，并且只能由具有相应权限的用户删除</li></ul></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="https://freeeeeeeeedom.gitee.io/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch26-31/" title="数据管理基础 ch26-31" target="_blank" rel="external">https://freeeeeeeeedom.gitee.io/2022/04/14/数据管理基础-ch26-31/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/Freeeeeeeeedom" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/Freeeeeeeeedom" target="_blank"><span class="text-dark">Free</span><small class="ml-1x">Joker &amp; Coder</small></a></h3><div>南京大学软件工程大二在读</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="prev"><a href="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch32-36/" title="数据管理基础 ch32-36"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;上一篇</span></a></li><li class="next"><a href="/2022/04/14/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch23-25/" title="数据管理基础 ch23-25"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>赏</span></button><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav><div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog"><div class="modal-dialog" role="document"><div class="modal-content donate"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><div class="modal-body"><div class="donate-box"><div class="donate-head"><p>感谢您的支持，我会继续努力的!</p></div><div class="tab-content"><div role="tabpanel" class="tab-pane fade active in" id="alipay"><div class="donate-payimg"><img src="/images/donate/alipayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开支付宝扫一扫，即可进行扫码打赏哦</p></div><div role="tabpanel" class="tab-pane fade" id="wechatpay"><div class="donate-payimg"><img src="/images/donate/wechatpayimg.png" alt="扫码支持" title="扫一扫"></div><p class="text-muted mv">扫码打赏，你说多少就多少</p><p class="text-grey">打开微信扫一扫，即可进行扫码打赏哦</p></div></div><div class="donate-footer"><ul class="nav nav-tabs nav-justified" role="tablist"><li role="presentation" class="active"><a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> 支付宝</a></li><li role="presentation"><a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> 微信支付</a></li></ul></div></div></div></div></div></div></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/Freeeeeeeeedom" target="_blank" title="Github" data-toggle="tooltip" data-placement="top"><i class="icon icon-github"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss" data-toggle="tooltip" data-placement="top"><i class="icon icon-rss"></i></a></li></ul><div class="copyright">&copy; 2022 WhooooRui<div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script defer src="https://cdn1.lncld.net/static/js/av-min-1.2.1.js"></script><script defer>function showTime(e){var e=new AV.Query(e),t=$(".leancloud_visitors");e.greaterThanOrEqualTo("time",0),e.find({success:function(e){var r;0!=e.length&&(r=e,t.each(function(){for(var e=$(this).attr("id").trim(),t=0;t<r.length;t++){var n=r[t],o=n.get("time");e==n.get("url")&&$(this).text(o)}}))},error:function(e,t){console.log("Error: "+t.code+" "+t.message)}})}function addCount(t){var t=AV.Object.extend("Counter"),e=(url=$(".leancloud_visitors").attr("id").trim(),title=$(".leancloud_visitors").attr("data-flag-title").trim(),new AV.Query(t));e.equalTo("url",url),e.find({success:function(e){0<e.length?((e=e[0]).fetchWhenSave(!0),e.increment("time"),e.save(null,{success:function(e){e=e.get("time");$(document.getElementById(url)).text(e)},error:function(e,t){console.log("Failed to save Visitor num, with error message: "+t.message)}})):((e=new t).set("title",title),e.set("url",url),e.set("time",1),e.save(null,{success:function(e){console.log("newcounter.get('time')="+e.get("time"));e=e.get("time");$(document.getElementById(url)).text(e)},error:function(e,t){console.log("Failed to create")}}))},error:function(e){console.log("Error:"+e.code+" "+e.message)}})}AV.init({appId:"mhyGN57MG6G9YJ3rtTn90n4c-gzGzoHsz",appKey:"D3FU0mepwLhB8BK48kSAaOLx"}),$(function(){var e=AV.Object.extend("Counter");(1==$(".leancloud_visitors").length?addCount:showTime)(e)})</script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(a){return-1<GUEST.indexOf(a)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"mhyGN57MG6G9YJ3rtTn90n4c-gzGzoHsz",appKey:"D3FU0mepwLhB8BK48kSAaOLx",placeholder:"Stay hungry,Stay foolish",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script><script>$(document).ready(function(){$("article img").not("[hidden]").not(".panel-body img").each(function(){var a,t,n=$(this),e=n.attr("alt"),r=n.parent("a");r.length<1&&(-1!=(t=(a=this.getAttribute("src")).lastIndexOf("?"))&&(a=a.substring(0,t)),r=n.wrap('<a href="'+a+'"></a>').parent("a")),r.attr("data-fancybox","images"),e&&r.attr("data-caption",e)}),$().fancybox({selector:'[data-fancybox="images"]',hash:!1,loop:!1})})</script></body></html>