<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>网络层 | 投降输一半</title><meta name="keywords" content="互联网计算"><meta name="author" content="胡小小小小睿"><meta name="copyright" content="胡小小小小睿"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Layer3: Network Layer 网络层  为什么我们不用硬件地址进行通信?  (设备数量问题)因为设备比较多，供应商也比较多 (规格问题)不同供应商的解决方案不同，所以使用硬件地址进行通信的通用性比较低。 (寻址问题)全球设备太多，如果使用硬件设备，那么进行定位比较复杂  因为如上情况我们选择使用IP地址(逻辑地址)。 本章比较重要，期末占比会比较大。  Over"><meta property="og:type" content="article"><meta property="og:title" content="网络层"><meta property="og:url" content="http://little-hurui.cloud/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/index.html"><meta property="og:site_name" content="投降输一半"><meta property="og:description" content="Layer3: Network Layer 网络层  为什么我们不用硬件地址进行通信?  (设备数量问题)因为设备比较多，供应商也比较多 (规格问题)不同供应商的解决方案不同，所以使用硬件地址进行通信的通用性比较低。 (寻址问题)全球设备太多，如果使用硬件设备，那么进行定位比较复杂  因为如上情况我们选择使用IP地址(逻辑地址)。 本章比较重要，期末占比会比较大。  Over"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://s2.loli.net/2022/04/20/3XeMHGig7AzNFCk.jpg"><meta property="article:published_time" content="2022-04-28T05:51:22.000Z"><meta property="article:modified_time" content="2022-06-02T14:57:36.000Z"><meta property="article:author" content="胡小小小小睿"><meta property="article:tag" content="互联网计算"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://s2.loli.net/2022/04/20/3XeMHGig7AzNFCk.jpg"><link rel="shortcut icon" href="https://s2.loli.net/2022/04/19/olzB7QMiuGqbjHe.jpg"><link rel="canonical" href="http://little-hurui.cloud/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"search.xml",languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:void 0,highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css"}},isPhotoFigcaption:!0,islazyload:!1,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"网络层",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2022-06-02 22:57:36"}</script><noscript><style type="text/css">#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0!==o){const a=new Date;o=864e5*o,t={value:t,expiry:a.getTime()+o};localStorage.setItem(e,JSON.stringify(t))}},get:function(e){var t=localStorage.getItem(e);if(t){t=JSON.parse(t);const o=new Date;if(!(o.getTime()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=a=>new Promise((t,e)=>{const o=document.createElement("script");o.src=a,o.async=!0,o.onerror=e,o.onload=o.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(o.onload=o.onreadystatechange=null,t())},document.head.appendChild(o)}),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><meta name="generator" content="Hexo 6.1.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:#ff0;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style><link rel="alternate" href="/atom.xml" title="投降输一半" type="application/atom+xml"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/04/20/iVOmaCTznfybv2A.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="avatar"></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">158</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">94</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/notes/"><i class="fa-fw fa fa-bold"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(https://s2.loli.net/2022/04/20/3XeMHGig7AzNFCk.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">投降输一半</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/notes/"><i class="fa-fw fa fa-bold"></i><span> 随笔</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/books/"><i class="fa-fw fa fa-book"></i><span> 书单</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">网络层</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-04-28T05:51:22.000Z" title="发表于 2022-04-28 13:51:22">2022-04-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-06-02T14:57:36.000Z" title="更新于 2022-06-02 22:57:36">2022-06-02</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/">互联网计算</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>44分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="网络层"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="layer3-network-layer-网络层">Layer3: Network Layer 网络层</h1><ol type="1"><li>为什么我们不用硬件地址进行通信?<ol type="1"><li>(设备数量问题)因为设备比较多，供应商也比较多</li><li>(规格问题)不同供应商的解决方案不同，所以使用硬件地址进行通信的通用性比较低。</li><li>(寻址问题)全球设备太多，如果使用硬件设备，那么进行定位比较复杂</li></ol></li><li>因为如上情况我们选择使用IP地址(逻辑地址)。</li><li>本章比较重要，期末占比会比较大。</li></ol><h1 id="overview-of-the-network-layer">Overview of the Network Layer</h1><ol type="1"><li>对于不同帧使用同一的方案进行处理</li><li>第三层希望通过<strong>路由选择算法</strong>进行路径的选择和转发，对第二层是透明的。</li><li>第三层只能避免拥塞，但是要到第四层(运输层)才能完成流量控制(第三层不能完成流量控制)</li></ol><h2 id="responsibilities-职责">Responsibilities 职责</h2><ul><li><p>Move data through networks</p><p>通过网络移动数据：不同网段之间的通信，不同的广播域，两个广播域之间的进行了划分，互不干扰，不是广播的通信以及对另一个网段的广播需要能传达给对方</p></li><li><p>Use a <em>hierarchical</em> addressing scheme (opposed to MAC addressing, which is flat)</p><p>使用分层寻址方案（和MAC寻址相反，后者平坦）</p></li><li><p>Segment network and control flow of traffic</p><p>细分网络并控制流量(flow)：一步步进行细化，越近了解的越多:IP地址是一致的，也就是可以忽略物理层的不同。(具体原因在开头已经分析过了)</p></li><li><p>Reduce congestion</p><p>减少交通拥堵，基于IP做分段和传达，用来减少拥塞</p></li><li><p>Talk to other network</p><p>与其他网络交谈</p></li></ul><p><img src="https://s2.loli.net/2022/04/25/XEW8cvyLj5euDTM.png"></p><ul><li>在上面我们可以发现，对于不同数据链路层的帧，第三层基于IP地址，来实现跨介质的逻辑理解和连通。</li><li>第三层负责进行连通和传达，数据可靠性由终端设备(第四层及以上)来进行保证(不然会带来比较大的计算量)。</li></ul><h2 id="devices-设备">Devices 设备</h2><ul><li><p>Routers</p><ul><li><p>Interconnect network segments <em>or</em> networks</p><p>互联网段 or 网络</p></li><li><p>Make logical decisions based on IP addresses</p><p>根据ip地址做出合理的决定</p></li><li><p>Determine best path</p></li></ul><p>根据路由表决定最佳路径</p><ul><li>Switch packets from incoming ports to outgoing ports</li></ul><p>将数据包从入站端口切换到出站端口</p></li></ul><p>如果A网段的设备向路由器发送了一个B网段的广播地址，那么路由器会进行转发，然而如果A网段设备发射的是本网段的广播地址，路由器不会进行转发（广播域划分）</p><h1 id="ip-addresses-and-subnets-ip地址和子网划分">IP Addresses and Subnets IP地址和子网划分</h1><h2 id="packetdatagram-封包数据报格式">Packet/Datagram 封包/数据报格式</h2><p><img src="https://s2.loli.net/2022/04/25/OEoYvuZTV6FWiwX.png"></p><p><strong>IP地址在报文中占据一部分(32bit一个IP地址)</strong></p><h2 id="ipv4-报文主要结构">IPv4 报文主要结构</h2><p><img src="https://s2.loli.net/2022/04/25/BOsK86gY3LFrR9P.png"></p><h3 id="首部部分">首部部分</h3><blockquote><p>首部部分：上面蓝框部分的整体是首部部分</p></blockquote><h3 id="版本号">版本号</h3><blockquote><p>版本号:占 4 bit，指IP协议的版本。目前的 IP 协议版本号为 4 (即 IPv4)(6也就对应IPv6</p></blockquote><h3 id="首部长度">首部长度</h3><blockquote><p>首部长度:占 4 bit，可表示的最大数值是15个单位(一个单位为 4 字节) 因此IP的首部长度的最大值是60字节。</p></blockquote><ol type="1"><li>因为首部长度是不确定的，所以我们需要进行标识。(用来方便读取)</li><li>首部长度的32 bit为一行，也就是4个字节为一个单位</li><li>所以IP报文首部字段长度为15行</li></ol><h3 id="服务类型">服务类型</h3><blockquote><p>服务类型:占8bit，用来获得更好的服务，这个字段以前一直没有被人们使用。</p></blockquote><h3 id="总长度">总长度</h3><blockquote><p>总长度:占 16 bit，指<strong>首部和数据</strong>之和的长度，单位为字节，因此数据报的最大长度为 65535 字节(由于放到帧里面，所以大多数不比1500字节长)。总长度必须不超过最大传送单元 MTU。</p></blockquote><h3 id="标识">标识</h3><blockquote><p>标识(identification):占 16 bit，它是一个计数器，用来产生数据报的标识。</p></blockquote><ol type="1"><li>他只是为了做报文分片的问题，因为路由器可能连接的是不同网络，比如有线帧和无线帧。</li><li>接收方依据标识号进行合并(相同标识号的报文是一个大报文，可以合并的)</li></ol><h3 id="标志">标志</h3><blockquote><p>标志占 3 bit，最高位为 0</p></blockquote><ol type="1"><li>让发送方对报文进行控制，让中间路由器对其进行控制</li><li>DF(Don't fragement):是否允许做分片，0允许做分片,1不允许做分片</li><li>MF:MF为0表示最后一个分片,1是指后面还有分片</li></ol><h3 id="片偏移">片偏移</h3><blockquote><p>片偏移(13 bit)指出：较长的分组在分片后某片在原分组中的相对位置。片偏移以8个字节为偏移单位。</p></blockquote><ol type="1"><li>相同标识号，然后根据片偏移进行重拍(先发未必先到)，偏移比较小的更靠前</li><li>因为16-3 = 13，2^3 = 8(因为单位是字节，所以用13位就可以补齐)</li><li>例子(计算偏移量):偏移是字节为单位</li></ol><p><img src="https://s2.loli.net/2022/04/26/z4TwGYJ5vSkLq7b.png"></p><p><img src="https://s2.loli.net/2022/04/26/WbB5dZhHpMLfn1q.png"></p><h3 id="生存时间">生存时间</h3><blockquote><p>生存时间(8 bit)记为 TTL (Time To Live) 数据报在网络中可通过的<strong>路由器数</strong>的最大值。</p></blockquote><ol type="1"><li>是通过计数的方式来进行统计</li><li>最大值是255(最多经过255个路由器)</li><li>路由器每转发一次，就会对生存时间-1</li><li>减小为0后，就会丢弃掉，并且通知给发送方我已经丢弃掉这个报文。</li><li>防止在环上进行传输，避免由于回路问题，造成过大的网络资源浪费</li></ol><h3 id="协议">协议</h3><blockquote><p>协议(8 bit)字段指出此数据报携带的数据使用何种协议以便目的主机的IP层将数据部分上交给哪个处理过程</p></blockquote><ol type="1"><li>有的协议是上层的</li><li>有的协议是第三层协议</li><li>具体协议的情况如下</li></ol><h3 id="首部检验和">首部检验和</h3><p><img src="https://s2.loli.net/2022/04/26/DHUTsyJVahIjSiW.png"></p><blockquote><p>首部检验和(16 bit)字段:只检验数据报的首部，不包括数据部分。这里不采用 CRC 检验码而采用简单的计算方法。算法过程如下(比较形式化的问题，并不能解决数据报错误的形式)</p></blockquote><p><img src="https://s2.loli.net/2022/04/26/VwiUXaIoTRjLPzQ.png"></p><ol type="1"><li>源地址和目的地址都各占 4 字节</li><li>15 * 4: 15行，每行4字节</li></ol><h2 id="网络层地址">网络层地址</h2><ol type="1"><li><p>IP addresses are 32 bits long</p><p>IP地址为32位长(Ipv4中)</p></li><li><p>They are represented as four octets in dotted decimal format 133.14.17.0</p><p>它们以点分十进制格式表示为四个八位字节：133.14.17.0</p></li><li><p>The IP address has two components:</p><p>IP地址包含两个组成部分：</p><ol type="1"><li><p>The network ID</p><p>网络ID</p></li><li><p>The host ID</p><p>主机ID</p></li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/3jPHJFGUnhNVelv.png"></p><h3 id="网络地址用来标识网段">网络地址：用来标识网段</h3><ol type="1"><li><p>assigned by ARIN (American Registry for Internet Numbers, www.arin.net)</p><p>原来由ARIN(美国互联网号码注册机构，www.arin.net)分配，现在已经换了</p></li><li><p>identifies the network to which a device is attached</p><p>标识设备所连接(attached)的网络</p></li><li><p>may be identified by one, two, or three of the first three octets</p><p>可以由前三个八位位组(octets)中的一个，两个或三个来标识</p></li></ol><h3 id="主机idip地址后面占据1-3个字节">主机ID：IP地址后面占据1-3个字节</h3><ol type="1"><li><p>assigned by a network administrator</p><p>由网络管理员分配</p></li><li><p>identifies the specific device on that network</p><p>识别该网络上的特定设备</p></li><li><p>may be identified by one, vvtwo, or three of the last three octets</p><p>可以由最后三个八位位组中的一个，两个或三个来标识</p></li></ol><h2 id="ip地址">IP地址</h2><ol type="1"><li><p>Different class addresses reserve different amounts of bits for the network and host portions of the address</p><p>不同的类地址为地址的网络部分和主机部分保留不同数量的位</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/uIAEU6FiOkWvsTg.png"></p><ol start="2" type="1"><li>N是Net ID,H 是 Host ID</li></ol><h3 id="分类">分类</h3><p><img src="https://s2.loli.net/2022/04/26/fuCd1kcMFVX5QIA.png"></p><ol type="1"><li>IP地址主要通过第一个字节进行划分</li><li>0–127 Class A address A类地址</li><li>128-191 Class B address B类地址</li><li>192–223 Class C address C类地址</li><li>224–239 Class D – Multicast D类地址：多播：视频点播的原理也是组播(多播)</li><li>240–255 Class E - Research E类地址：研究</li></ol><h3 id="主机的数量">主机的数量</h3><ol type="1"><li><p>The maximum number of hosts vary for each class.</p><p>每个类别的最大主机数量各不相同。(不包含网络号)</p><ol type="1"><li>A类拥有16,777,214个可用主机(2<sup>24</sup> – 2)</li><li>Class B has 65,534 available hosts (2<sup>16</sup> – 2) B类具有65,534个可用主机(2<sup>16</sup> – 2)</li><li>Class C has 254 available hosts (2<sup>8</sup> – 2) C类具有254个可用主机(2<sup>8</sup> –2)</li></ol></li><li><p>为什么每一类地址中都要减去2？</p><ol type="1"><li><p>The first address in each network is reserved for the network address</p><p>每个网络中的第一个地址都保留用于该网络地址</p></li><li><p>The last address is reserved for the broadcast address</p><p>最后一个地址是为广播地址保留的。</p></li></ol></li></ol><h3 id="保留reserved地址">保留(Reserved)地址</h3><ol type="1"><li>网络地址:在地址的主机部分中以二进制0结尾的IP地址<ol type="1"><li>A类网络地址示例：113.0.0.0</li><li>网络上的主机只有具有相同网络ID的其他主机才能直接通信。(用来确定是不是在一个网段里面)</li></ol></li><li>广播地址:用于将数据发送到网络上的所有设备。(一般是一个网段之间的)<ol type="1"><li>广播IP地址在地址的主机部分中以二进制1结尾。</li><li>B类地址的广播地址的示例:176.10.255.255 (decimal 255 = binary 11111111)</li></ol></li><li>Class A<ol type="1"><li>99.0.0.0: a reserved network number</li><li>99.255.255.255: a broadcast number</li></ol></li><li>Class B<ol type="1"><li>156.1.0.0: a reserved network number</li><li>156.1.255.255: a broadcast number</li></ol></li><li>Class C<ol type="1"><li>203.1.17.0: a reserved network number</li><li>203.1.17.255:a broadcast number</li></ol></li></ol><h3 id="private-address-space-专用地址空间">Private Address Space 专用地址空间</h3><blockquote><ol type="1"><li>10.0.0.0 - 10.255.255.255</li><li>172.16.0.0 - 172.31.255.255</li><li>192.168.0.0 - 192.168.255.255</li></ol></blockquote><ol type="1"><li><p>There are certain IP address ranges reserved for private IP addressing schemes.</p><p>有某些IP地址范围保留用于专用IP寻址方案(Schemas)。上述地址都是用作局域网的内部网段。</p></li><li><p>IP address depletion and its solutions</p><p>IP地址耗尽及其解决方案</p><ol type="1"><li>NAT</li><li>CIDR</li><li>IPv6(最终解决方案)</li></ol></li><li><p>发展过程:网络位数小于24，使得其可以组成超网。</p></li><li><p>多个网段进行划分，保留足够的个人子网网段划分</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/lMLcUYwvgQKNtZo.png"></p><h2 id="子网划分">子网划分</h2><ol type="1"><li><p>Network administrators sometimes need to divide networks into smaller networks, called <em>subnets</em>, in order to provide extra flexibility</p><p>网络管理员有时需要将网络划分为较小的网络，称为<strong>子网</strong>，以提供<strong>额外的灵活性</strong>.</p></li><li><p>Bits are borrowed from the host field and are designated as the subnet field</p><p>从主机字段借来的位被指定为子网字段(Subnet Fields)</p></li><li><p>ABC类网的主机数量比较大,会造成浪费，因为avalible的很多，很少能够用满。</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/V1kIfwSbKHWmNhx.png"></p><ol start="4" type="1"><li>从Host中借位进行子网划分</li><li>子网掩码:是由发送方提供。</li><li>大的子网划分为小的子网来提高灵活性和利用率。</li></ol><h3 id="子网划分的基本概念">子网划分的基本概念</h3><ol type="1"><li><p>Subnets are smaller divisions of networks</p><p>子网是网络的较小部分</p><ol type="1"><li><p>provide addressing flexibility</p><p>提供寻址灵活性。(小的局域网可以完成隔离)</p></li><li><p>子网划分只需要本网段网络管理员进行处理即可，每一个子网也是一个网络(子网只是一个逻辑形式)</p></li></ol></li><li><p>Subnet addresses are assigned locally, usually by a network administrator.</p><p>子网地址通常由网络管理员在本地分配:每一个子网也是一个Net，实际上是和Net是一个标准的</p></li><li><p>Subnets reduce a broadcast domain</p><p>子网减少了广播域:使得广播域变小，提高网络利用率，避免接受到大量的无用的广播，广播只能在对应子网中进行广播。</p></li></ol><h3 id="how-many-bits-can-i-borrow-我们可以借多少位">How many bits can I borrow? 我们可以借多少位？</h3><ol type="1"><li><p>The minimum number of bits you can borrow is <strong>two</strong></p><p>可以借用的最小位数是2</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/Wwys1kuYaXmDetv.png"></p><ol type="1"><li><p>The minimum number of bits borrowed is 2,WHY?</p><p>借用的最小位数是2，为什么？</p></li><li><ol type="1"><li><p>If you were to borrow only 1 bit, to create a subnet, then you would only have a network number - the .0 network - and the broadcast number - the .1 network</p><p>如果只借用1位以创建一个子网，那么您将只有一个网络号-.0网络-和广播号-.1网络，没有可以使用的专用网络。</p></li><li><p>两位的时候，01和10给Host，00给网络ID，11位广播地址</p></li><li><p>全0可能导致误判</p></li></ol></li><li><p>The maximum number of bits that can be borrowed can be any number that leaves at least 2 bits, remaining, for the host number</p><p>可以借用的最大位数可以是保留至少2位主机号的任何数字(给Host至少保留2位，因为1位的话，要么一个是NET无法使用，要么一个是广播地址)</p></li><li><ol type="1"><li>A类网络 20位</li><li>B类网络 14位</li><li>C类网络 6位</li></ol></li><li><p>互联网早期时，计算机比较少，没有划分子网。</p></li></ol><h3 id="byproduct-waste-addresses-子网划分的副产品地址浪费">Byproduct: Waste Addresses 子网划分的副产品：地址浪费</h3><ol type="1"><li><p>We must strike a balance between the number of subnets required, the hosts per subnet that is acceptable, and the resulting waste of addresses</p><p>我们必须在所需的子网数，每个子网可接受的主机以及地址的浪费之间取得平衡(strike a balance)。</p></li><li><ol type="1"><li>hostID里面的全0和全1不能使用</li><li>subnet不可以使用全0和全1</li><li>借用4位是最高效率的，提升了划分灵活性，影响了效率</li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/4YFUAclW2ZTv9ho.png"></p><h3 id="subnet-mask-子网掩码">Subnet Mask 子网掩码</h3><ol type="1"><li><p>Alias: extended network prefix</p><p>别名:扩展网络前缀</p></li><li><p>define how many bits we use to construct the network, and how many bits to describe the host addresses</p><p>定义我们用来构建网络的位数，以及描述主机地址的位数</p></li><li><ol type="1"><li>Class A 255.0.0.0</li><li>Class B 255.255.0.0</li><li>Class C 255.255.255.0</li></ol></li></ol><h3 id="calculating-a-subnet-计算子网">Calculating a Subnet 计算子网</h3><ol type="1"><li><p>We will subnet the IP address: 223.14.17.0</p><p>我们有一个C类网络：223.14.17.0</p></li><li><p>我们需要完成如下划分</p><ol type="1"><li>划分成13个子网</li><li>每个子网有10个主机</li></ol></li></ol><h4 id="第一步">第一步</h4><ol type="1"><li><p>Determine the default subnet mask</p><p>确定默认的子网掩码</p></li><li><p>Class C default subnet mask: 255.255.255.0</p><p>C类网络的默认子网掩码是：255.255.255.0</p></li></ol><h4 id="第二步">第二步</h4><ol type="1"><li><p>Figure the actual number of subnets and hosts by borrowing bits from host ID</p><p>通过从主机ID借用位来计算子网和主机的实际数量</p></li><li><p>Borrow 4 bits from the host</p><p>我们对每一个子网需要借用4位来满足一个子网有10台可用的主机。</p></li></ol><h4 id="第三步">第三步</h4><p><img src="https://s2.loli.net/2022/04/26/aKtqZboBeNzW7sO.png"></p><ol type="1"><li><p>We get 16 <em>possible</em> subnets and 16 <em>possible</em> hosts for each subnet because:</p><p>我们为每个子网获得16个可能的子网和16个可能的主机，因为：</p><ol type="1"><li><p>For the 4 bits borrowed each bit can be a 1 or a 0 leaving you with 24 or 16 possible combinations</p><p>对于<strong>借用的4位</strong>，每个位可以是1或0，从而有<span class="math inline"><mjx-container class="MathJax" jax="SVG"><svg style="vertical-align:0" xmlns="http://www.w3.org/2000/svg" width="2.119ex" height="1.904ex" role="img" focusable="false" viewBox="0 -841.7 936.6 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mn" transform="translate(533,363) scale(0.707)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g></g></svg></mjx-container></span>或16种可能的组合。</p></li><li><p>The same goes for the 4 leftover host bits</p><p>4个剩余主机位也是如此。</p></li></ol></li><li><p>Important: There are only 14 <em>available</em> subnets and hosts on each subnet. Why?</p><p>重要：每个子网上只有14个可用子网和主机。(一般情况下，而可用的是15个可用子网，因为0号子网可用)</p><ul><li><p>Because you cannot use the first and last subnet.</p><p>因为您不能使用第一个和最后一个子网。</p></li><li><p>Because you cannot use the first and last address within each subnet.</p><p>因为您不能使用每个子网中的第一个和最后一个地址。</p></li><li><p>For each, one is the broadcast address and one is the network address</p><p>对于每个，一个是广播地址，一个是网络地址。</p></li></ul></li></ol><h4 id="第四步">第四步</h4><ol type="1"><li><p>Determine the subnet mask.</p><p>确定子网掩码。</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/EjAFk7ebYChWrmJ.png"></p><ol type="1"><li><p>Where X represents the borrowed bits for subnetting</p><p>其中X表示用于子网划分的借用位。</p></li><li><p>Add the place values of X together to get the last octet decimal value of the subnet mask.</p><p>将X的位值相加，得到子网掩码的最后一个八位位组十进制值：128 + 64 + 32 + 16 = 240</p></li><li><p>子网掩码是：255.255.255.240</p></li><li><p>The subnet mask is used to reveal the subnet and host address fields in IP addresses.</p><p>子网掩码用于显示IP地址中的子网和主机地址字段</p></li></ol><h4 id="第五步">第五步</h4><ol type="1"><li><p>Determine the ranges of host addresses</p><p>确定主机地址的范围</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/dEW5jeA2wLvyn13.png"> <img src="https://s2.loli.net/2022/04/26/dEW5jeA2wLvyn13.png"></p><ol type="1"><li><p>16 <em>possible</em> subnets.</p><p>16个子网</p><p>14 <em>available</em> subnets</p><p>14个可用子网</p></li><li><p>16 <em>possible</em> hosts on each subnet</p><p>每个子网16个主机</p><p>14 <em>available</em> hosts on each subnet</p><p>14个可用主机</p></li></ol><h3 id="计算子网网络地址">计算子网网络地址</h3><ol type="1"><li><p>Step 1: Change the IP host address to binary.</p><p>第一步：将IP主机地址转换为二进制。</p></li><li><p>Step 2: Change the subnet mask to binary.</p><p>第二步：将子网掩码转换为二进制。</p></li><li><p>Step 3: Use the boolean operator AND to combine the two.</p><p>第三步：使用布尔运算符AND将两者进行运算。</p></li><li><p>Step 4: Convert the network binary address to dotted decimal</p><p>第四步：将网络二进制地址转换为点分十进制。</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/7aQ9pSHmOvE1PWb.png"></p><ol type="1"><li><p>This is the subnet network address</p><p>这是子网的网络地址</p></li><li><p>It can help determine path</p><p>它可以帮助确定路径：用来确定是否是一个网段，是否可以通过网关进行转发</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/scEIwYSMqTBxQA2.png"></p><ol type="1"><li><p>In order to find the network ID of a subnet, the router must take the IP address, and the subnet mask, and logically, AND them together</p><p>为了找到子网的网络ID，路由器必须采用IP地址和子网掩码，并且在逻辑上将它们取和</p></li><li><p>路由器根据运算的结果进行计算</p></li><li><p>上图中的子网掩码255.255.255.0是255.255.0.0借用了8位产生的(而不要理解成为C类地址的子网掩码)</p></li></ol><h2 id="实践ip寻址问题">实践:IP寻址问题</h2><ol type="1"><li>Given 195.137.92.0 and needing 8 usable subnets, find the subnetwork numbers, the ranges of host numbers, and subnetwork broadcast numbers. 给定195.137.92.0并且需要8个可用子网，请找到子网号，主机号范围和子网广播号。</li><li>IP Address is a class C. Default subnet mask is 255.255.255.0. We need to extend the network number by enough bits to give 8 usable subnets. IP地址是C类。默认子网掩码是255.255.255.0。 我们需要将网络号扩展足够的位数以提供8个可用子网。</li><li>Stealing 2 bits yields 2 usable subnets, stealing 3 bits yields 6 usable subnets, so we must steal 4 bits to get 14 usable subnets, of which we needed 8. 借用2位会产生2个可用子网，借用3位会产生6个可用子网，因此我们借用4位才能获得14个可用子网，其中我们需要8个可用地址。</li><li>This makes the subnet mask 255.255.255.240. So the Network number is 195.137.92.NNNN HHHH where Ns stand for network extension bits (subnets) and Hs stand for host numbers. 这将使子网掩码为255.255.255.240。 因此，网络号为195.137.92.NNNN HHHH，其中Ns代表网络扩展位(子网)，Hs代表主机号。</li><li>Next we must number the subnets; there are 16 combinations of 4 bit binary numbers but they retain their place value within the last octet. 接下来，我们必须为子网编号。 4位二进制数有16种组合，但它们在最后一个八位位组中保留其位置值。</li><li>借用4-6位都可以，因为并没有规定子网中主机数量，而为什么是6位是因为一个子网中最少用2位给主机。</li></ol><h1 id="layer-3-devices-第三层设备">Layer 3 Devices 第三层设备</h1><ol type="1"><li>第三层的路由器</li><li>路由器的两个功能:<ol type="1"><li>路径选择</li><li>路由转发:将报文转发取出</li></ol></li></ol><h2 id="path-determination-路径选择">Path determination 路径选择</h2><ol type="1"><li><p>The router uses to choose the next hop in the path for the packet to travel to its destination based on the link bandwidth, hop, delay …</p><p>路由器用于根据链路带宽，跳数，延迟 …</p></li><li><p>选择数据包到达目的地的路径中的下一跳。</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/zlQ5hLcieHNrRCE.png"></p><ol start="4" type="1"><li>Internet 核心层的冗余链路是很必要的(相对于路径选项消耗，其可靠性和稳定性更加重要)</li><li>路由器根据路由规范，选择他当时认为最为合适的路径</li></ol><h2 id="ip地址-1">IP地址</h2><ol type="1"><li><p>IP addresses are implemented in software, and refer to the network on which a device is located</p><p>IP地址是用软件实现的，是指设备所在的网络。</p></li><li><p>Routers connect networks, each of which must have a unique network number in order for routing to be successful.</p><p>路由器连接网络，每个网络必须具有唯一的网络号才能成功进行寻找路径。</p></li><li><p>The unique network number is incorporated into the IP address that is assigned to each device attached to that network</p><p>唯一的网络号包含在分配(incorporated)给该网络上每个设备的IP地址中</p></li><li><p>IP地址是逻辑的，是我们配置的。(不同于MAC地址)</p></li><li><p>IP地址是有层次，做转发的依据是网段而不是具体的IP，同一网段设备都有相同的IP地址，也就是我们只要到达网段即可</p></li></ol><h2 id="路由器端口">路由器端口</h2><p><img src="https://s2.loli.net/2022/04/26/n1ReDGyS52a3HXA.png"></p><ol type="1"><li>路由器端口记录了网段的IP地址(和连接的地方是相同的)</li></ol><h2 id="路由器发送的过程">路由器发送的过程</h2><p><img src="https://s2.loli.net/2022/04/26/u9QOiVedMkIfUDn.png"></p><ol type="1"><li>A5主机发送报文给B5主机，这个报文的IP地址是B5所在的IP地址，形成帧，然后放上总线。</li></ol><p><img src="https://s2.loli.net/2022/04/26/1XYp8sw95Sucoat.png"></p><ol start="2" type="1"><li>路由器收到帧，然后进行理解，看到报文，知道目的地是B5(解封装)</li></ol><p><img src="https://s2.loli.net/2022/04/26/MbfdVO8qTQzt4jA.png"></p><ol start="3" type="1"><li>检查自己的路由表，找到目的地对应的端口</li></ol><p><img src="https://s2.loli.net/2022/04/26/Zz1GxgEDewW5o7I.png"></p><ol start="4" type="1"><li>在B1端口进行转发，形成新的帧</li></ol><p><img src="https://s2.loli.net/2022/04/26/KoAFL1MHCk8ltSu.png"></p><ol type="1"><li>形成一个全新的帧，这个帧的MAC地址是B1的MAC的地址。</li></ol><h2 id="路由器端口示例">路由器端口示例</h2><p><img src="https://s2.loli.net/2022/04/26/1KYbPCQlqNAUjcm.png"></p><ol type="1"><li><p>Interface is a router’s attachment to a network, it may also be referred to as a port in IP routing.</p><p>接口是路由器连接到网络的附件，在IP路由中也可以称为端口。</p></li><li><p>这个IP地址往往被作为这个网络的网关</p></li><li><p>Each interface must have a separate, unique network address</p><p>每个接口必须具有一个单独的唯一网络地址。</p></li><li><ol type="1"><li>比如上图中S1和S2不能是相同的IP地址</li><li>路由器的连接的网段一定要是不同的</li></ol></li></ol><h2 id="ip地址分配">IP地址分配</h2><ol type="1"><li><p>静态地址分配(Static addressing)</p><ol type="1"><li><p>Configure each individual device with an IP address</p><p>为每个单独的设备配置一个IP地址</p></li><li><p>You should keep very meticulous records, because problems can occur if you use duplicate IP addresses</p><p>您应该保留非常细致的记录，因为如果使用重复的IP地址，可能会出现问题。</p></li><li><p>需要知道规范，然后根据上下文，通过命令行进行分配地址</p></li></ol></li><li><p>动态地址分配(Dynamic addressing)</p><ul><li><p>There are a few different methods can be used to assign IP addresses dynamically</p><p>有几种不同的方法可用于动态分配IP地址：</p><ul><li>RARP: Reverse Address Resolution Protocol. RARP：反向地址解析协议。发起请求</li><li>BOOTP: BOOTstrap Protocol. BOOTP：BOOTstrap协议。用于工作栈</li><li>DHCP: Dynamic Host Configuration Protocol. (比较多用) DHCP：动态主机配置协议</li></ul></li></ul></li><li><p>IP地址和掩码处理后得到网络地址，保证每个网段中的主机的网段地址应该是一致的，不然会出现错误的。</p></li></ol><h2 id="arp-protocol-arp协议">ARP Protocol ARP协议</h2><h3 id="address-resolution-protocol-地址解析协议">Address Resolution Protocol 地址解析协议</h3><ol type="1"><li><p>In order for devices to communicate, the sending devices need both the IP addresses and the MAC addresses of the destination devices.</p><p>为了使设备进行通信，发送设备需要目标设备的<strong>IP地址和MAC地址</strong>。</p></li><li><p>ARP enables a computer to find the MAC address of the computer that is associated with an IP address</p><p>ARP使计算机能够查找与IP地址关联的计算机的MAC地址。</p></li><li><p>目的方IP地址 -&gt; 目的方MAC地址</p></li><li><p>需要知道对方的MAC地址，来形成数据地址。</p></li></ol><h3 id="arp示例">ARP示例</h3><p><img src="https://s2.loli.net/2022/04/26/oUaEzdujiVxKfSM.png"></p><ol type="1"><li>source主机访问destination</li><li>不知道目的主机在哪里</li></ol><h3 id="arp表的缓存">ARP表的缓存</h3><p><img src="https://s2.loli.net/2022/04/26/UINjWtlnhBic4zZ.png"></p><ol type="1"><li>可以通过lookup命令进行。</li><li>在RAM里面，如果ARP没有本条目的对应MAC地址。</li><li>MAC地址在ARP中是有时效性的。到时间不更新不激活就会删除</li></ol><h3 id="arp的操作">ARP的操作</h3><p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec04/30.png"></p><ol type="1"><li>使用ARP机制</li><li>上图中是一个示意图</li><li>此时ARP table中没有缓存</li><li>图问题:目的MAC地址应该在前面，源MAC地址字后面</li></ol><h4 id="arp-request">ARP request</h4><p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec04/31.png"></p><ol type="1"><li>向目的方请求MAC地址</li><li>命令如图：就是找谁是这个主机，你的MAC地址是啥</li><li>将MAC地址设置为全1，作为广播发送</li></ol><h4 id="arp-checking">ARP Checking</h4><p><img src="https://s2.loli.net/2022/04/26/yQHUI1eRl7KgaXP.png"></p><ol type="1"><li>10.0.2.5发现不是自己的主机，那么解析到这里丢掉就行，同样会记录下来对应的发送方的MAC地址。(攻击原理)</li><li>10.0.2.9发现自己的MAC地址，然后形成ARP应答</li><li>同时10.0.2.9会同时记录下A主机的MAC地址，更新到自己ARP地址中去(会记录对方的)</li></ol><h4 id="arp-reply">ARP reply</h4><p><img src="https://s2.loli.net/2022/04/26/aCM2tHO3RufnVsl.png"></p><ol type="1"><li>向A主机进行MAC地址应答</li></ol><h4 id="arp-caching">ARP Caching</h4><p><img src="https://s2.loli.net/2022/04/26/vBxmQ1GqARnauCi.png"></p><ol type="1"><li>A的主机就会把对应的条目写到ARP Table中</li><li>然后再次形成一个数据帧发送出去即可。</li></ol><h3 id="arp-destination-local-目的地址为本地">ARP: Destination local 目的地址为本地</h3><p><img src="https://s2.loli.net/2022/04/26/TVmbU5jLGaNcPKk.png"></p><ol type="1"><li>ARP请求是本网段形成的，是一个广播就可以。</li><li>如果目的主机不在本网段中，那么不能跨网段进行广播</li></ol><h3 id="arp-internetwork-communication-网络交流">ARP: Internetwork Communication 网络交流</h3><p><img src="https://s2.loli.net/2022/04/26/C8VLOkP9R2IuaAJ.png"></p><ol type="1"><li>如何与不在同一物理网段上的设备通信？如下是两种解决方案。<ol type="1"><li>Default gateway 默认网关</li><li>Proxy ARP 代理ARP</li></ol></li></ol><h4 id="default-gateway-默认网关">Default gateway 默认网关</h4><ol type="1"><li><p>In order for a device to communicate with another device on another network, you must supply it with a default gateway.</p><p>为了使设备与另一网络上的另一设备通信，您必须为其提供<strong>默认网关</strong>。</p></li><li><p>A default gateway is the IP address of the interface on the router that connects to the network segment on which the source host is located.</p><p><strong>默认网关是路由器上连接到源主机所在网段的接口的IP地址。</strong></p></li><li><p>In order for a device to send data to the address of a device that is on another network segment, the source device sends the data to a default gateway.</p><p>为了使设备将数据发送到另一个网段上的设备的地址，源设备将数据发送到<strong>默认网关</strong>。</p></li><li><p>192.168.0.0和192.168.0.1接入到路由器，如果网关错误是无法进行转发的。自己搭建拓扑需要手动配置。</p><ol type="1"><li>由网关对对应报文进行转发，默认网关就是</li><li>THPCP Server进行动态生成</li></ol></li><li><p>帧被发送到另一个不通过网段的链路无意义</p></li><li><p>发送报文到另一个网段，需要路由器把对应端口的网关的MAC告诉你，然后通过网关进行转发。</p></li></ol><h4 id="proxy-arp-代理arp">Proxy ARP 代理ARP</h4><ol type="1"><li><p>代理ARP是ARP的一种变体(variation)。</p></li><li><p>In the case the source host does not have a default gateway configured.</p><p>如果源主机未配置默认网关。</p></li></ol><p><img src="https://s2.loli.net/2022/04/26/ipAMHZeVT5gjL1a.png"></p><ol type="1"><li>发送ARP请求，然后路由器给你一个ARP的reply，告诉你MAC地址(一般为本端口的IP地址)</li></ol><h3 id="destination-not-local-arp对应目的方不是本地">Destination not local ARP对应目的方不是本地</h3><p><img src="https://s2.loli.net/2022/04/26/lgEekbCTO9dNMD6.png"></p><ol type="1"><li>路由器会把Router MAC的地址给你(连接本网段的MAC地址)</li></ol><h3 id="arp-flowchart-arp流程图">ARP Flowchart ARP流程图</h3><p><img src="https://s2.loli.net/2022/04/26/yZOkV93pJ5wYoIW.png"></p><ol type="1"><li>ARP攻击：有一个机器恶意发送无用帧，然后会将cache写满(解决就是一段时间不处理，然后等待ARP记录中的记录失效)</li><li>ARP学习是收到不同的帧，对帧进行保存</li><li>每一个ARP是有声明期的</li></ol><h1 id="network-layer-services-网络层设备">Network Layer Services 网络层设备</h1><h2 id="connection-oriented-network-services-面向连接的网络服务">Connection oriented network services 面向连接的网络服务</h2><p>A connection is established between the sender and the recipient before any data is transferred.</p><p><img src="https://s2.loli.net/2022/04/26/xHEMcdSCJbZrKyq.png"></p><ol type="1"><li>面向连接的网络服务<ol type="1"><li>就是任何发送数据的行为之前，先要建立好连接，协商好参数才会开始传输，所有数据进行有序传输</li><li>网络情况导致数据出现问题，需要接受方进行一定处理来保证数据正确</li></ol></li><li>传输过程中要保持连接距离，只有完成传输后才能断开连接。</li><li>传输比较可靠，代价高。</li></ol><h2 id="无连接的网络服务">无连接的网络服务</h2><p><img src="https://s2.loli.net/2022/04/26/YFQnLVim6OcgoKX.png"></p><ol type="1"><li>他们分别对待每个数据包。</li><li>IP是<strong>无连接系统</strong>。</li><li>不要求发送方和接收方在发送前先建立一个连接(不打招呼)。</li><li>系统不需要进行大量的数据保留，不需要很多的缓存</li><li>局域网使用的比较多，可靠性比较低，不处理报文丢失</li><li>可靠网中，少量报文使用无连接是可以提高效率的(常用于比较小型的，并且可靠性相对比较高的网络)</li></ol><h2 id="电路交换circuit-switched">电路交换(Circuit switched)</h2><ol type="1"><li><p>Connection-oriented vs. circuit switched.</p><p>面向连接与电路交换。</p><ol type="1"><li><p>However, the two terms are not the same</p><p>但是，这两个词并不相同</p></li><li><p>要先建立一个虚电路关系，之后报文走对应的虚电路。</p></li></ol></li><li><p>Connection-oriented: establish a connection with the recipient, first, and then begin the data transfer</p><p>面向连接：首先与接收者建立连接，然后开始数据传输。</p></li><li><p>All packets travel sequentially across the same channel, or more commonly, across the same virtual circuit</p><p>所有数据包依次在同一通道上传播，或更常见的是在同一虚拟电路上传播。</p></li><li><p>问题:电路的利用效率低，一个人用了别人就不能用了(虚电路可能是分段建立，可能局部可以复用，但是整体不可以复用)。</p></li><li><p>虚电路要强于面向连接的，传输更加可靠，保证<strong>传输先后关系</strong>。</p></li></ol><h2 id="报文交换packet-switched">报文交换(Packet Switched)</h2><ol type="1"><li><p>Connectionless network vs. packet switched： The two terms are not the same, either</p><p>无连接网络与数据包交换:这两个词都不一样</p></li><li><p>When the packets pass from source to destination, they can:</p><p>当数据包从源传递到目标时，它们可以：</p><ol type="1"><li><p>Switch to different paths.</p><p>切换到其他路径。(每一报文有各自的发送方和接收方，可以根据当前的网络情况，进行路由选择)</p></li><li><p>Arrive out of order.</p><p>乱序到达。</p></li></ol></li><li><p>Devices make the path determination for each packet based on a variety of criteria. Some of the criteria may differ from packet to packet.</p><p>设备根据<strong>各种标准</strong>为每个数据包<strong>确定路径</strong>。某些标准可能因分组而异。</p></li><li><p>将原始数据分为很多的子报文(单位)，每个子报文(单位)自己选择路径进行发送。</p></li><li><p>大部分的Connetionless network都是基于packet switched进行实现，控制网络拥塞。</p></li><li><p>出现问题时候，我们只需要重传对应部分的报文就可以(不用重传全部数据)</p></li></ol><h1 id="network-layer-网络协议操作">Network Layer 网络协议操作</h1><p><img src="https://s2.loli.net/2022/04/26/UB3DhaLxuCylTOw.png"></p><ol type="1"><li>存在冗余，A转发给B是由当前网络状态处理。</li><li>ABC之间都是通过帧进行计算的。</li></ol><h2 id="routed-protocol-被动可路由协议">Routed protocol 被动可路由协议</h2><ol type="1"><li>为网络层提供支持的协议称为路由协议或可路由协议。</li><li>IP是网络层协议，因此，它可以通过互联网络进行路由。</li></ol><h2 id="non-routable-protocol-不可路由协议">Non-routable protocol 不可路由协议</h2><ol type="1"><li><p>Non-routable protocols are protocols that do not support Layer 3</p><p>不可路由协议是不支持第3层的协议。</p></li><li><p>The most common of these non-routable protocols is NetBEUI</p><p>这些不可路由协议中最常见的是NetBEUI。</p><ol type="1"><li>直接根据目的方的地址在局域网中进行生成定位</li><li>这个协议不支持第三层，也就是跨局域网是不可以的。</li></ol></li><li><p>NetBEUI is a small, fast, and efficient protocol that is limited to running on one segment</p><p>NetBEUI是一种小型，快速且高效的协议，仅限于在一个网段上运行。</p></li></ol><h2 id="addressing-of-a-routable-protocol-被动可路由协议的寻址">Addressing of a routable protocol 被动可路由协议的寻址</h2><p><img src="https://s2.loli.net/2022/04/26/hMlbis51yArX26a.png"></p><p><strong>Routing table</strong></p><p><img src="https://s2.loli.net/2022/04/26/yZ9YnAFegQG3hz7.png"></p><ol type="1"><li>路由器连接三个网段(列出来的是网络号)</li><li>将目的主机和掩码进行逻辑AND操作，得到对应的网段</li><li>然后请求路由表可以发现E2端口为目的网段</li><li>再次将报文封装转发给对应的主机</li><li>路由表是存储在内存中的</li></ol><h2 id="classification-static-and-dynamic-路由协议的分类静态动态">Classification : Static and Dynamic 路由协议的分类:静态、动态</h2><ol type="1"><li><p>Static routes: The network administrator manually enter the routing information in the router</p><p>静态路由：网络管理员在路由器中手动输入路由信息。</p></li><li><p>Dynamic routes:</p><p>动态路由</p><ol type="1"><li><p>Routers can learn the information from each other on the fly.</p><p>路由器可以在运行过程中互相学习信息。</p></li><li><p>Using routing protocol to update routing information</p><p>使用路由协议更新路由信息。</p></li><li><p>RIP, IGRP, EIGRP, OSPF …</p></li><li><p>人工维护的代价比较大</p></li></ol></li></ol><h3 id="static-vs.-dynamic-routes-静态路由和动态路由的区别">Static vs. dynamic routes 静态路由和动态路由的区别</h3><ol type="1"><li><p>静态路由</p><ol type="1"><li><p>For hiding parts of an internetwork 用于<strong>隐藏</strong>部分网络。安全(不必进行路由表的交换)</p></li><li><p>To test a particular link in a network 测试网络中的特定链接。</p></li><li><p>For maintaining routing tables whenever there is only one path to a destination network.</p><p>用于仅在到达目标网络的路径时维护路由表。</p></li></ol></li><li><p>动态路由</p><ol type="1"><li>Maintenance of routing table 维护路由表。</li><li>Timely distribution of information in the form of routing updates 以路由更新的形式及时分发信息。</li><li>Relies on routing protocol to share knowledge 依靠路由协议共享知识。</li><li>Routers can adjust to changing network conditions. 路由器可以调整以适应不断变化的网络状况。</li><li>打开后会启动<strong>进程</strong>，按照不同的协议，和网上的不同设备学习信息，然后根据<strong>算法</strong>生成路由表</li></ol></li></ol><h3 id="routing-protocol-主动路由协议routing">Routing protocol 主动路由协议(Routing)</h3><ol type="1"><li><p>Routing protocols determine the paths that routed protocols follow to their destinations.</p><p>路由协议确定路由协议遵循的到达目的地的路径。</p></li><li><p>是用来构建路由表的，所以叫做routing</p></li><li><p>公平、简单、适应变化等特点</p></li></ol><h2 id="routed-vs.-routing-protocol-被动路由协议和主动路由协议">Routed vs. Routing protocol 被动路由协议和主动路由协议</h2><p><img src="https://s2.loli.net/2022/04/26/l1uoFkrXJB4KhwH.png"></p><ol type="1"><li>Routed Portocol用于路由器之间，用来保证路由器之间连通(完成转发)，保证路由器有效连通。</li><li>Routing Protocol用于做各自的路由表的生成：路由器彼此交换信息。</li><li>Routing Protocol 决定 Routed Protocals</li></ol><h2 id="动态路由协议的分类内部网关协议和外部网关协议">动态路由协议的分类：内部网关协议和外部网关协议</h2><ol type="1"><li><p>Interior Gateway Protocols (RIP, IGRP, EIGRP, OSPF):</p><p>内部网关协议(Interior Gateway Protocols，RIP，IGRP，EIGRP，OSPF)：</p><p>Be used within an autonomous system, a network of routers under one administration, like a corporate network, a school district's network, or a government agency's network.</p><p>可在自治系统(autonomous system，大的单位或者管理方)中使用，该系统是一个主管部门下的路由器网络，例如公司(corporate)网络，学区的网络或政府机构的网络。</p></li><li><p>Exterior Gateway Protocols (EGP, BGP):</p><p>外部网关协议(Exterior Gateway Protocols，EGP，BGP)：</p><p>Be used to route packets between autonomous systems.</p><p>用于在自治系统之间路由数据包。</p></li><li><p>自治系统是<strong>逻辑</strong>的划分,而未必是物理层次的划分。</p></li><li><p>通过BGP，让其他自治系统了解自己的自治系统中的网段。</p></li><li><p>内部网关协议和外部网关协议的区别：</p><ol type="1"><li>一个单位对自己内部的网络管理负责，用一些协议。</li><li>IGP是内部确定的管理规则，BGP(EGP)标准来沟通不同自己系统。</li></ol></li></ol><h2 id="内部网关协议的分类dvp-and-lsp">内部网关协议的分类：DVP and LSP</h2><ol type="1"><li>距离矢量协议(Distance-Vector Protocols，RIP, IGRP):<ol type="1"><li>View network topology from neighbor’s perspective. 从<strong>邻居</strong>的角度查看网络拓扑。(注意不基于全局)</li><li>Add distance vectors from router to router. 在路由器之间添加距离向量。(根据跳数来决定，经过一个路由器+1一次)</li><li>Frequent, periodic updates 经常定期(periodic)更新。</li><li>Pass copy of routing tables to neighbor routers 将路由表的<strong>副本</strong>传递到邻居路由器。</li></ol></li><li>链路状态协议(Link State Protocols, OSPF):<ol type="1"><li>Gets common view of entire network topology 获取整个网络拓扑的通用视图。(全局的视角，会有代价)</li><li>Calculates the shortest path to other routers. 计算到其他路由器的最短路径。(基于带宽计算出来的cost，形成cost拓扑图，然后计算出对应的路径代价作为评判依据)</li><li>Event-triggered updates <strong>事件</strong>触发的更新。</li><li>Passes link state routing updates to other routers 将链接状态路由更新传递给其他路由器。</li></ol></li></ol><h3 id="distance-vector-routing-距离矢量协议dvp的示例">Distance vector routing 距离矢量协议(DVP)的示例</h3><p><img src="https://s2.loli.net/2022/04/26/5xihw9XL6NAyjVd.png"></p><ol type="1"><li>初始的时候，各自持有的是黑色的部分(直连的线路)</li><li>定时路由表会相互交换给邻居，下一时刻C学习到B，B学习到AC，A学习到B，在下一刻进行再次的转发。</li><li>DVP只知道到达一个网段的最少跳数(但是不知道最佳路径)。</li><li>会生成路由回路</li></ol><h3 id="riprouting-information-protocol-dv的代表">RIP(Routing Information Protocol) DV的代表</h3><ol type="1"><li>最受欢迎。(实现算法简单，更加靠谱)</li><li>基于距离矢量的内部网关协议。</li><li>唯一的指标是跳数。</li><li>最大跳数为15。(评判依据简单，是一个短板)</li><li>每30秒更新一次(广播)，可以修改。</li><li>并非总是选择最快的路径(而是走跳数最短的路径)。</li><li>产生大量的网络流量。</li><li>RIP v2是RIP v1的改进版本<ul><li>RIP v1用地址广播</li><li>RIP v2用主播地址广播，支持身份认证、路由等，比较安全，常用</li></ul></li></ol><h3 id="link-state-routing-链路状态协议lsp">Link state routing 链路状态协议(LSP)</h3><p><img src="https://s2.loli.net/2022/04/26/BKyiYsjO8zeGfWt.png"></p><blockquote><p>上图中的Routing table应该叫做初始时刻的Routing Table(本图的问题)</p></blockquote><ol type="1"><li>彼此交换连接情况，交换的是<strong>Link state</strong>而不是路由表，包含link的信息，以NetID作为主键(无相同网段)，包含的是link上的路由器邻接关系、链路类型(4种)、链路带宽，会指定谁连接了谁，这个条目就被称为Database(表)。这样子就不仅仅知道链路，还知道更多的全局信息。</li><li>LSP操作过程:<ol type="1"><li>相互交换彼此学到对应的Tpological Database(是全局的信息)</li><li>之后使用SPF算法，以自己为根，通过最短路径优先算法，生成以自己为根的树</li><li>根据这一个树再生成路由表(了解全局的信息)，逻辑是树的逻辑。</li></ol></li><li>LSP不是进行定时进行交换的，而是初始的时候进行交换，稳定之后，根据<strong>事件触发</strong>的时候才会更新数据。<ol type="1"><li>更新后发送给所有的路由器，需要将Database发送给所有的路由器</li><li>收到的路由器的，根据database更新自己的树，然后再次生成路由表。</li></ol></li><li>LSP是指从所有可达的道路上找到代价最小的路径。</li><li>全局可能会比较大，考虑负载进行处理</li><li>但是没有路由回路，单域内一般不超过20个路由器</li><li>路由表一般只保存一个最优的转发点的(负载均衡)</li></ol><h3 id="ospfopen-shortest-path-first">OSPF(Open Shortest Path First)</h3><ol type="1"><li>最短路径优先协议，是基于链路状态的内部网关协议，消耗CPU和内存。</li><li>指标由<strong>带宽</strong>，速度，流量，可靠性和安全性组成，本科阶段只考虑带宽的。</li><li>事件触发的更新。</li><li>最快和什么有关？(最快指的是带宽)<ol type="1"><li>和实时各条链路上的通信冗余有关，也和管理方案有关，简单来说是和带宽有关</li><li>带宽表示为代价，带宽和代价成<strong>反比</strong>。</li></ol></li></ol><h3 id="igrp-interior-gateway-routing-protocol-and-eigrp-enhanced-igrp">IGRP (Interior Gateway Routing Protocol) and EIGRP (Enhanced IGRP)</h3><ol type="1"><li><p>Cisco proprietary. 思科知识产权的。</p></li><li><p>Interior Gateway Protocol. 基于距离矢量的内部网关协议。</p></li><li><p>Distance Vector Protocol. IGRP最大跳数为255。</p></li><li><p>Metric is compose of bandwidth, load, delay and reliability</p><p>EIGRP指标由<strong>带宽(bandwidth)，负载(load)，延迟(delay)和可靠性(reliability)</strong>组成。加权进行运算</p></li><li><p>Updates every 90 seconds 每90秒更新一次。</p></li><li><p>EIGRP is an advanced version of IGRP, that is hybrid routing protocol.</p><p>EIGRP是IGRP的高级版本，它是<strong>混合</strong>路由协议(不全是根据跳数来计算)。</p></li><li><p>IOS 12.0以后，不支持IGRP，在模拟器中还可以。</p></li><li><p>EIGRP是可以的，和华为等路由器是不兼容的。(因为知识版权是思科独有的)</p></li></ol><h1 id="vlsmvariable-length-subnet-mask-可变长度子网掩码">VLSM(Variable Length Subnet Mask) 可变长度子网掩码</h1><h2 id="classful-routing-vlsm-经典路由和可变长度子网掩码">Classful routing &amp; VLSM 经典路由和可变长度子网掩码</h2><h3 id="classful-routing-经典路由classful-routing-无子网掩码">Classful routing 经典路由(Classful routing) 无子网掩码</h3><ol type="1"><li><p>Classful routing protocols require that a single network use the same subnet mask</p><p>有类的路由协议要求单个网络使用相同的子网掩码。</p></li><li><p>例如：网络192.168.187.0必须仅使用一个子网掩码，例如255.255.255.0。</p></li><li><p>会造成网络号的浪费(为了规格一致，为了保证标准一致，会浪费一些网络号)，比如路由器之间的网络没有必要给很多的hostID。</p></li><li><p>特定的情况:将路由器端口的掩码作为目的网络的掩码，可以进一步完成细化</p></li></ol><h3 id="vlsm-variable-length-subnet-masks-可变长度子网掩码variable-length-subnet-masks-有子网掩码">VLSM — Variable-Length Subnet Masks 可变长度子网掩码(Variable-Length Subnet Masks) 有子网掩码</h3><ol type="1"><li><p>VLSM is simply a feature that allows a single autonomous system to have networks with different subnet masks.</p><p>VLSM只是一项功能，它允许单个自治系统的网络具有不同的子网掩码。</p></li><li><p>有效的解决网络号浪费的问题</p></li></ol><h2 id="vslm-可变长度子网掩码">VSLM 可变长度子网掩码</h2><ol type="1"><li><p>With VLSM, a network administrator can</p><p>使用VLSM，网络管理员可以在主机少的网络上使用长掩码，而在主机多的子网上使用短掩码。(提供了很高的灵活性)</p></li><li><p>如果路由协议允许VLSM</p><ol type="1"><li>在路由网络连接上使用30位子网掩码255.255.255.252</li><li>用户网络的24位掩码255.255.255.0</li><li>或者，对于最多1000个用户的网络，甚至是22位掩码255.255.252.0。(保留10位)</li></ol></li><li><p>在CIDR的基础上发展的，报文中包含有子网掩码。</p></li></ol><h2 id="为什么使用vlsm">为什么使用VLSM</h2><ol type="1"><li><p>VLSM allows an organization to use more than one subnet mask within the same network address space</p><p>VLSM允许组织在同一网络地址空间内使用多个子网掩码。</p></li><li><p>Implementing VLSM is often referred to as "subnetting a subnet", and can be used to maximize addressing efficiency.</p><p>实施VLSM通常被称为"子网划分"，可用于最大化寻址效率。</p></li><li><p>VLSM is one of the modifications that has helped to bridge the gap between IPv4 and IPv6.</p><p>VLSM是有助于缩小IPv4和IPv6之间差距的修改(modifications)之一。</p></li></ol><h2 id="vlsm优缺点">VLSM优缺点</h2><h3 id="vlsm的优点">VLSM的优点</h3><ol type="1"><li>Efficient use of IP addresses 高效使用IP地址</li><li>Better route aggregation 更好的路由聚合(aggregation):构建超网</li></ol><h3 id="vlsm的缺点">VLSM的缺点</h3><ol type="1"><li><p>会导致地址空间的浪费:广播地址和网络号都无法被使用。</p><ol type="1"><li><p>In the past, it has been recommended that the first and last subnet not be used. But we can used the Subnet 0 from Cisco IOS ver12.0</p><p>过去，建议不要使用第一个和最后一个子网。但是我们可以使用Cisco IOS ver12.0中的子网0。</p></li><li><p>从IOS ver12.0起，Cisco路由器默认使用零子网。</p></li><li><p>如果想要禁止零子网，使用该指令:<code>router(config)#no ip subnet-zero()</code></p></li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/3Sqe1oWpnFk9Pd5.png"></p><blockquote><p>上图解释了子网长度相同会造成怎样的浪费(在路由器所在的子网段我们只需要满足2个主机，也就是需要2位的主机号就可以完成操作) 每一个位置都需要30个主机,有7个子网可以使用(全零可以使用，而全一不可以使用)</p></blockquote><h2 id="support-vlsm-routing-protocol-支持vlsm的路由协议">Support VLSM Routing Protocol: 支持VLSM的路由协议</h2><ol type="1"><li>Open Shortest Path First (OSPF) 开放式最短路径优先(OSPF)</li><li>Integrated Intermediate System to Intermediate System (Integrated IS-IS) 集成中间系统到中间系统(集成IS-IS)</li><li>Enhanced Interior Gateway Routing Protocol (EIGRP) 增强型内部网关路由协议(EIGRP)</li><li>RIP v2</li><li>Static routing 静态路由</li></ol><h2 id="vlsm的表示法">VLSM的表示法</h2><p><img src="https://s2.loli.net/2022/04/26/lz8KqfTxe73XBcd.png"></p><ol type="1"><li>斜杠的含义是指前面多少位保留给网络位</li><li>此时也就是/30就可以满足路由器之间的网络连通所需(减少浪费)，剩下的网络地址可以在以后网络进行扩展</li><li>这个例子中不使用VLSM还是可以进行解决的</li></ol><h2 id="vlsm的例子">VLSM的例子</h2><p><img src="https://s2.loli.net/2022/04/26/mwiH4o176nt8zrp.png"></p><h3 id="划分背景">划分背景</h3><ol type="1"><li>已分配192.168.10.0/24的C类地址。<ol type="1"><li>珀斯，悉尼和新加坡与吉隆坡建立WAN连接。</li><li>珀斯需要60个主机</li><li>KL需要28个主机</li><li>悉尼和新加坡分别需要12位房东。</li></ol></li><li>先划分成大的子网，然后进一步进行划分，然后在慢慢进行细化</li><li>为了计算VLSM子网，各个主机首先从地址范围分配最大的需求。需求级别应从最大到最小列出。</li></ol><h3 id="第一步满足珀斯的主机需求">第一步:满足珀斯的主机需求</h3><ol type="1"><li>在此示例中，珀斯需要60个主机号。</li><li>使用6位，因为2<sup>6</sup> – 2 = 62个可用主机地址。因此，将从第四个八位位组开始使用2位来表示/26的扩展网络前缀，其余6位将用于主机地址。</li><li>在地址192.168.10.0/24上应用VLSM可得到：<ol type="1"><li>192.168.10.00 hh hhhh /26</li><li>255.255.255.192 (1100 0000)</li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/mW5fUDySJlVXNKF.png"></p><ol start="4" type="1"><li>第一个给Perth使用，剩下的用作保留未使用的</li></ol><h3 id="第二步为吉隆坡划分子网">第二步:为吉隆坡划分子网</h3><ol type="1"><li>吉隆坡需要28台主机号。192.168.10.63/26之后的下一个可用地址是192.168.10.64/26。</li><li>由于需要28个主机，因此主机地址需要5位，即25 –2 = 30个可用主机地址。</li><li>因此，将需要5位来表示主机，而将使用3位来表示扩展网络前缀/27</li><li>在地址192.168.10.64/26上应用VLSM可得到：<ol type="1"><li>192.168.10.010 hhhhh /27</li><li>255.255.255.224 (1110 0000)</li><li>三个子网再借用一位</li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/V3CqER5sS1y7z6e.png"></p><h3 id="第三步为悉尼和新加坡进行分配地址">第三步:为悉尼和新加坡进行分配地址</h3><ol type="1"><li>现在，悉尼和新加坡分别需要12位主机号。 下一个可用地址从192.168.10.96/27开始。</li><li>由于需要12个主机，因此主机地址需要4位，即24 = 16、16 – 2 = 14个可用地址。</li><li>因此，需要4位来表示主机，对于/28的扩展网络前缀需要4位。</li><li>在地址192.168.10.96/27上应用VLSM可得到：<ol type="1"><li>192.168.10.0110 hhhh /28</li><li>255.255.255.240 (1111 0000)</li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/49nbf1adACErFBT.png"></p><h3 id="第四步为之间的路由地址进行划分">第四步:为之间的路由地址进行划分</h3><ol type="1"><li>现在为WAN连接分配地址。请记住，每个WAN连接都需要两个IP地址。下一个可用的子网是192.168.10.128/28。</li><li>由于每个WAN链路需要2个网络地址，因此主机地址需要2位，即22 –2 = 2个可用地址。</li><li>因此，需要2位来表示链接，并需要6位来表示扩展网络前缀/30。</li><li>在192.168.10.128/28上应用VLSM可得到：<ol type="1"><li>192.168.10.011000 hh /30</li><li>255.255.255.252 (1111 1100)</li></ol></li></ol><p><img src="https://s2.loli.net/2022/04/26/261UmiDox9aOdES.png"></p><p><img src="https://s2.loli.net/2022/04/26/6MymPAOrfv2z5jI.png"></p><ol start="5" type="1"><li>通过上述方法，从主机需求量大的部分入手，到主机需求量小的部分是很好的方法。</li></ol><h2 id="vlsm-例子总结">VLSM: 例子总结</h2><ol type="1"><li>重要的是要记住，只有未使用的子网才能进一步划分子网。</li><li>如果使用了子网中的任何地址，则该子网不能再进行子网划分。</li><li>一般是从主机多大到主机少(路由间网络)进行划分</li></ol><h2 id="路由聚集route-aggregation">路由聚集(Route Aggregation)</h2><ol type="1"><li>使用无类域间路由(CIDR，Classless InterDomain Routing)和VLSM不仅可以防止地址浪费，而且还可以促进路由聚合或汇总。</li><li>多个路由条目汇聚成小的路由条目</li><li>比如如下图就是讲3个/24的子网合并成一个/16的网络高速远端</li><li>优点:聚集之后我们只需要知道一个网段就可以，也就是远端的路由表就会变少</li></ol><p><img src="https://s2.loli.net/2022/04/26/WsKGVQgUAbplOei.png"></p><h2 id="路由聚集的例子">路由聚集的例子</h2><p><img src="https://s2.loli.net/2022/04/26/ZvlgT8uCL2UEHr6.png"></p><ol type="1"><li>多层聚集</li></ol><h2 id="如何进行路由聚集">如何进行路由聚集</h2><p><img src="https://spricoder.oss-cn-shanghai.aliyuncs.com/2020-Internet-computing/img/lec04/60.png"></p><blockquote><p>如何进行计算:将尽可能多的位进行聚集，将之后的不通过的位置，作为Host位，就得到了上图的结果</p></blockquote><h2 id="路由聚集的优点">路由聚集的优点</h2><ol type="1"><li>减少路由表条目的数量。</li><li>可用于隔离拓扑更改(聚集之后，只能得到大的网段的信息，因为小的网段的拓扑变化会比较频繁，导致路由表进行不断地计算，只公告比较高聚集后的路由的网段信息)</li></ol><h2 id="路由隔离的其他内容">路由隔离的其他内容</h2><ol type="1"><li>为了使聚合正常工作，请以分层方式(hierarchical fashion)仔细分配地址，以便汇总的地址将共享相同的高位。</li><li>VLSM允许路由聚合，并且通过将聚合完全基于左侧共享的高阶位来灵活地增加，即使网络不连续也是如此。</li><li>路由聚集需要严谨，不能让A和B两个端口的聚集后的网络号相同</li><li>VLSM是不做连续性检验的，也就是就算不连续也会进行聚集</li><li>全0子网会在题目中说是否可用</li><li>全1子网尽量不要使用</li></ol><h1 id="因特网控制报文协议-icmp">因特网控制报文协议 ICMP</h1><ol type="1"><li>ICMP (Internet Control Message Protocol)：为了提高 IP 数据报交付成功的机会(消息管理和协商)</li><li>ICMP 允许主机或路由器<strong>报告</strong>差错情况和提供有关异常情况的报告</li><li>ICMP 只是IP层的协议</li><li>ICMP 报文作为IP层数据报的数据，加上数据报的首部，组成 IP 数据报发送出去</li><li>一般路由器在丢弃报文的时候(处理之前已经提到的情况)，都会返回一个ICMP差错报文</li></ol><h2 id="icmp-报文的格式">ICMP 报文的格式</h2><p><img src="https://s2.loli.net/2022/04/26/dsKa3mOh5txEFnf.png"></p><ol type="1"><li>前四个字节是一样的(格式化的)</li><li>后面都是个根据类型</li></ol><h2 id="两种icmp报文">两种ICMP报文</h2><p><img src="https://s2.loli.net/2022/04/26/HtNkbsmv1LSDxef.png"></p><ol type="1"><li>查询报文:一般这种情况不是很多</li><li>差错报告报文:一般这种类型会多一些</li></ol><h2 id="目的站不可到达">目的站不可到达</h2><ol type="1"><li><strong>网络</strong>不可到达(net unreachable)</li><li><strong>主机</strong>不可到达(host unreachable)</li><li><strong>协议</strong>不可到达(protocol unreachable)</li><li><strong>端口</strong>不可到达(port unreachable)</li><li><strong>源路由选择</strong>不能完成(source route failed)</li><li>目的网络<strong>不可知</strong>(unknown destination network)</li><li>目的主机<strong>不可知</strong>(unknown destination host)</li><li>不可知是完全不可以解析，不可达是可以解析但是不可以到达</li></ol><h2 id="icmp-差错报告报文的数据字段的内容">ICMP 差错报告报文的数据字段的内容</h2><p><img src="https://s2.loli.net/2022/04/26/L5IkuZAbl487HBo.png"></p><ol type="1"><li>一般会把原始的IP数据报文的数据报首部 + 8字节(数据的，可能会包含端口信息)作为ICMP的数据部分</li><li>ICMP的前8个字节的是确定的(前4个字节是类型，校验位，后面四个字节是确定的)</li><li>然后添加一个首部作为IP数据报进行发送。</li></ol><h2 id="不应发送-icmp-差错报告报文的几种情况">不应发送 ICMP 差错报告报文的几种情况</h2><ol type="1"><li>对 ICMP 差错报告报文不再发送 ICMP 差错报告报文</li><li>对第一个分片的数据报片的所有后续数据报片都不发送 ICMP 差错报告报文(就是每次传送只要发送一次就够了)</li><li>对具有多播地址的数据报都不发送 ICMP 差错报告报文</li><li>对具有特殊地址(如127.0.0.0或0.0.0.0)的数据报不发送 ICMP 差错报告报文<ol type="1"><li>127.0.0.0:逻辑回路地址</li><li>0.0.0.0:确认路由地址</li></ol></li></ol><h2 id="ping-packet-internet-groper">PING (Packet InterNet Groper)</h2><ol type="1"><li>PING 是用ICMP的"Echo request"和"Echo reply"消息来实现的</li><li>PING 用来测试两个主机之间的连通性，一般是用来检查局域网的连通性：PING不通，不仅仅是发送不过去，有可能是应答不回来。</li><li>PING 使用了ICMP回送请求与回送回答报文</li><li>PING 是应用层直接使用网络层ICMP的例子，它没有通过运输层的TCP或UDP</li></ol></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">胡小小小小睿</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://little-hurui.cloud/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/">http://little-hurui.cloud/2022/04/28/%E7%BD%91%E7%BB%9C%E5%B1%82/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://little-hurui.cloud" target="_blank">投降输一半</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%92%E8%81%94%E7%BD%91%E8%AE%A1%E7%AE%97/">互联网计算</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/04/20/3XeMHGig7AzNFCk.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://s2.loli.net/2022/04/19/RFQ7a3WzipEBlS2.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/04/19/RFQ7a3WzipEBlS2.jpg" alt="wechat"></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="https://s2.loli.net/2022/04/19/faP7b2XxJlQqVrp.jpg" target="_blank"><img class="post-qr-code-img" src="https://s2.loli.net/2022/04/19/faP7b2XxJlQqVrp.jpg" alt="alipay"></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/03/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E5%9F%BA%E7%A1%80-ch58-61/"><img class="prev-cover" src="https://s2.loli.net/2022/04/19/DquNoIv35WETV1M.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">数据管理基础 ch58-61</div></div></a></div><div class="next-post pull-right"><a href="/2022/04/27/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/"><img class="next-cover" src="https://s2.loli.net/2022/04/21/qxZvt8C9HAaf7Dp.jpg" onerror='onerror=null,src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数据链路层</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/27/%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" title="数据链路层"><img class="cover" src="https://s2.loli.net/2022/04/21/qxZvt8C9HAaf7Dp.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-27</div><div class="title">数据链路层</div></div></a></div><div><a href="/2022/06/01/WANS/" title="WANS"><img class="cover" src="https://s2.loli.net/2022/04/21/fyLSJbKegHcZPaC.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-01</div><div class="title">WANS</div></div></a></div><div><a href="/2022/04/26/%E7%89%A9%E7%90%86%E5%B1%82/" title="物理层"><img class="cover" src="https://s2.loli.net/2022/04/21/xho7LGY1rNv39le.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-26</div><div class="title">物理层</div></div></a></div><div><a href="/2022/06/01/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" title="网络安全"><img class="cover" src="https://s2.loli.net/2022/04/21/WMmplIwF7TcrVJh.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-01</div><div class="title">网络安全</div></div></a></div><div><a href="/2022/03/02/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%8F%8A%E5%85%B6%E5%8F%82%E8%80%83%E6%A8%A1%E5%9E%8B/" title="计算机网络及其参考模型"><img class="cover" src="https://s2.loli.net/2022/04/21/1vp8IXgb2fkdyVl.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-02</div><div class="title">计算机网络及其参考模型</div></div></a></div><div><a href="/2022/05/27/Routing-and-Routers/" title="Routing and Routers"><img class="cover" src="https://s2.loli.net/2022/04/21/XMLs3gzETBrNet2.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-27</div><div class="title">Routing and Routers</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s2.loli.net/2022/04/20/iVOmaCTznfybv2A.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="avatar"></div><div class="author-info__name">胡小小小小睿</div><div class="author-info__description">Stay hungry Stay foolish</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">158</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">94</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">29</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Freeeeeeeeedom"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Freeeeeeeeedom" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://space.bilibili.com/629788196" target="_blank" title="Bilibili"><i class="fa fa-bold"></i></a><a class="social-icon" href="https://www.zhihu.com/people/over-47-40" target="_blank" title="Zhihu"><i class="fa fa-fighter-jet"></i></a><a class="social-icon" href="https://leetcode-cn.com/u/dega-vu/" target="_blank" title="Leetcode"><i class="fa fa-check-square"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">I'm free, gone with wind.</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#layer3-network-layer-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">Layer3: Network Layer 网络层</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#overview-of-the-network-layer"><span class="toc-number">2.</span> <span class="toc-text">Overview of the Network Layer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#responsibilities-%E8%81%8C%E8%B4%A3"><span class="toc-number">2.1.</span> <span class="toc-text">Responsibilities 职责</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devices-%E8%AE%BE%E5%A4%87"><span class="toc-number">2.2.</span> <span class="toc-text">Devices 设备</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ip-addresses-and-subnets-ip%E5%9C%B0%E5%9D%80%E5%92%8C%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="toc-number">3.</span> <span class="toc-text">IP Addresses and Subnets IP地址和子网划分</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#packetdatagram-%E5%B0%81%E5%8C%85%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.1.</span> <span class="toc-text">Packet&#x2F;Datagram 封包&#x2F;数据报格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ipv4-%E6%8A%A5%E6%96%87%E4%B8%BB%E8%A6%81%E7%BB%93%E6%9E%84"><span class="toc-number">3.2.</span> <span class="toc-text">IPv4 报文主要结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%83%A8%E9%83%A8%E5%88%86"><span class="toc-number">3.2.1.</span> <span class="toc-text">首部部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E5%8F%B7"><span class="toc-number">3.2.2.</span> <span class="toc-text">版本号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%83%A8%E9%95%BF%E5%BA%A6"><span class="toc-number">3.2.3.</span> <span class="toc-text">首部长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.4.</span> <span class="toc-text">服务类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E9%95%BF%E5%BA%A6"><span class="toc-number">3.2.5.</span> <span class="toc-text">总长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E8%AF%86"><span class="toc-number">3.2.6.</span> <span class="toc-text">标识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%BF%97"><span class="toc-number">3.2.7.</span> <span class="toc-text">标志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%87%E5%81%8F%E7%A7%BB"><span class="toc-number">3.2.8.</span> <span class="toc-text">片偏移</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%AD%98%E6%97%B6%E9%97%B4"><span class="toc-number">3.2.9.</span> <span class="toc-text">生存时间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.2.10.</span> <span class="toc-text">协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E9%83%A8%E6%A3%80%E9%AA%8C%E5%92%8C"><span class="toc-number">3.2.11.</span> <span class="toc-text">首部检验和</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E5%9C%B0%E5%9D%80"><span class="toc-number">3.3.</span> <span class="toc-text">网络层地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E7%94%A8%E6%9D%A5%E6%A0%87%E8%AF%86%E7%BD%91%E6%AE%B5"><span class="toc-number">3.3.1.</span> <span class="toc-text">网络地址：用来标识网段</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BAidip%E5%9C%B0%E5%9D%80%E5%90%8E%E9%9D%A2%E5%8D%A0%E6%8D%AE1-3%E4%B8%AA%E5%AD%97%E8%8A%82"><span class="toc-number">3.3.2.</span> <span class="toc-text">主机ID：IP地址后面占据1-3个字节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80"><span class="toc-number">3.4.</span> <span class="toc-text">IP地址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">3.4.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E6%9C%BA%E7%9A%84%E6%95%B0%E9%87%8F"><span class="toc-number">3.4.2.</span> <span class="toc-text">主机的数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%9D%E7%95%99reserved%E5%9C%B0%E5%9D%80"><span class="toc-number">3.4.3.</span> <span class="toc-text">保留(Reserved)地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#private-address-space-%E4%B8%93%E7%94%A8%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4"><span class="toc-number">3.4.4.</span> <span class="toc-text">Private Address Space 专用地址空间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86"><span class="toc-number">3.5.</span> <span class="toc-text">子网划分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.5.1.</span> <span class="toc-text">子网划分的基本概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#how-many-bits-can-i-borrow-%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E5%80%9F%E5%A4%9A%E5%B0%91%E4%BD%8D"><span class="toc-number">3.5.2.</span> <span class="toc-text">How many bits can I borrow? 我们可以借多少位？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#byproduct-waste-addresses-%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E7%9A%84%E5%89%AF%E4%BA%A7%E5%93%81%E5%9C%B0%E5%9D%80%E6%B5%AA%E8%B4%B9"><span class="toc-number">3.5.3.</span> <span class="toc-text">Byproduct: Waste Addresses 子网划分的副产品：地址浪费</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#subnet-mask-%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">3.5.4.</span> <span class="toc-text">Subnet Mask 子网掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calculating-a-subnet-%E8%AE%A1%E7%AE%97%E5%AD%90%E7%BD%91"><span class="toc-number">3.5.5.</span> <span class="toc-text">Calculating a Subnet 计算子网</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="toc-number">3.5.5.1.</span> <span class="toc-text">第一步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5"><span class="toc-number">3.5.5.2.</span> <span class="toc-text">第二步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5"><span class="toc-number">3.5.5.3.</span> <span class="toc-text">第三步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5"><span class="toc-number">3.5.5.4.</span> <span class="toc-text">第四步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AD%A5"><span class="toc-number">3.5.5.5.</span> <span class="toc-text">第五步</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%AD%90%E7%BD%91%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80"><span class="toc-number">3.5.6.</span> <span class="toc-text">计算子网网络地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5ip%E5%AF%BB%E5%9D%80%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.</span> <span class="toc-text">实践:IP寻址问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#layer-3-devices-%E7%AC%AC%E4%B8%89%E5%B1%82%E8%AE%BE%E5%A4%87"><span class="toc-number">4.</span> <span class="toc-text">Layer 3 Devices 第三层设备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#path-determination-%E8%B7%AF%E5%BE%84%E9%80%89%E6%8B%A9"><span class="toc-number">4.1.</span> <span class="toc-text">Path determination 路径选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80-1"><span class="toc-number">4.2.</span> <span class="toc-text">IP地址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.3.</span> <span class="toc-text">路由器端口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8F%91%E9%80%81%E7%9A%84%E8%BF%87%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">路由器发送的过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8%E7%AB%AF%E5%8F%A3%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.5.</span> <span class="toc-text">路由器端口示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ip%E5%9C%B0%E5%9D%80%E5%88%86%E9%85%8D"><span class="toc-number">4.6.</span> <span class="toc-text">IP地址分配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#arp-protocol-arp%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.7.</span> <span class="toc-text">ARP Protocol ARP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#address-resolution-protocol-%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.7.1.</span> <span class="toc-text">Address Resolution Protocol 地址解析协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.7.2.</span> <span class="toc-text">ARP示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp%E8%A1%A8%E7%9A%84%E7%BC%93%E5%AD%98"><span class="toc-number">4.7.3.</span> <span class="toc-text">ARP表的缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">4.7.4.</span> <span class="toc-text">ARP的操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-request"><span class="toc-number">4.7.4.1.</span> <span class="toc-text">ARP request</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-checking"><span class="toc-number">4.7.4.2.</span> <span class="toc-text">ARP Checking</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-reply"><span class="toc-number">4.7.4.3.</span> <span class="toc-text">ARP reply</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arp-caching"><span class="toc-number">4.7.4.4.</span> <span class="toc-text">ARP Caching</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp-destination-local-%E7%9B%AE%E7%9A%84%E5%9C%B0%E5%9D%80%E4%B8%BA%E6%9C%AC%E5%9C%B0"><span class="toc-number">4.7.5.</span> <span class="toc-text">ARP: Destination local 目的地址为本地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp-internetwork-communication-%E7%BD%91%E7%BB%9C%E4%BA%A4%E6%B5%81"><span class="toc-number">4.7.6.</span> <span class="toc-text">ARP: Internetwork Communication 网络交流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#default-gateway-%E9%BB%98%E8%AE%A4%E7%BD%91%E5%85%B3"><span class="toc-number">4.7.6.1.</span> <span class="toc-text">Default gateway 默认网关</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proxy-arp-%E4%BB%A3%E7%90%86arp"><span class="toc-number">4.7.6.2.</span> <span class="toc-text">Proxy ARP 代理ARP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#destination-not-local-arp%E5%AF%B9%E5%BA%94%E7%9B%AE%E7%9A%84%E6%96%B9%E4%B8%8D%E6%98%AF%E6%9C%AC%E5%9C%B0"><span class="toc-number">4.7.7.</span> <span class="toc-text">Destination not local ARP对应目的方不是本地</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arp-flowchart-arp%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">4.7.8.</span> <span class="toc-text">ARP Flowchart ARP流程图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#network-layer-services-%E7%BD%91%E7%BB%9C%E5%B1%82%E8%AE%BE%E5%A4%87"><span class="toc-number">5.</span> <span class="toc-text">Network Layer Services 网络层设备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#connection-oriented-network-services-%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.</span> <span class="toc-text">Connection oriented network services 面向连接的网络服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E8%BF%9E%E6%8E%A5%E7%9A%84%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.</span> <span class="toc-text">无连接的网络服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%B5%E8%B7%AF%E4%BA%A4%E6%8D%A2circuit-switched"><span class="toc-number">5.3.</span> <span class="toc-text">电路交换(Circuit switched)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E4%BA%A4%E6%8D%A2packet-switched"><span class="toc-number">5.4.</span> <span class="toc-text">报文交换(Packet Switched)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#network-layer-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">Network Layer 网络协议操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#routed-protocol-%E8%A2%AB%E5%8A%A8%E5%8F%AF%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.1.</span> <span class="toc-text">Routed protocol 被动可路由协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#non-routable-protocol-%E4%B8%8D%E5%8F%AF%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.2.</span> <span class="toc-text">Non-routable protocol 不可路由协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#addressing-of-a-routable-protocol-%E8%A2%AB%E5%8A%A8%E5%8F%AF%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AF%BB%E5%9D%80"><span class="toc-number">6.3.</span> <span class="toc-text">Addressing of a routable protocol 被动可路由协议的寻址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#classification-static-and-dynamic-%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%86%E7%B1%BB%E9%9D%99%E6%80%81%E5%8A%A8%E6%80%81"><span class="toc-number">6.4.</span> <span class="toc-text">Classification : Static and Dynamic 路由协议的分类:静态、动态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#static-vs.-dynamic-routes-%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E5%92%8C%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">6.4.1.</span> <span class="toc-text">Static vs. dynamic routes 静态路由和动态路由的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#routing-protocol-%E4%B8%BB%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AErouting"><span class="toc-number">6.4.2.</span> <span class="toc-text">Routing protocol 主动路由协议(Routing)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#routed-vs.-routing-protocol-%E8%A2%AB%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E5%92%8C%E4%B8%BB%E5%8A%A8%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.5.</span> <span class="toc-text">Routed vs. Routing protocol 被动路由协议和主动路由协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%86%E7%B1%BB%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE%E5%92%8C%E5%A4%96%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.6.</span> <span class="toc-text">动态路由协议的分类：内部网关协议和外部网关协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%BD%91%E5%85%B3%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%88%86%E7%B1%BBdvp-and-lsp"><span class="toc-number">6.7.</span> <span class="toc-text">内部网关协议的分类：DVP and LSP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#distance-vector-routing-%E8%B7%9D%E7%A6%BB%E7%9F%A2%E9%87%8F%E5%8D%8F%E8%AE%AEdvp%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.7.1.</span> <span class="toc-text">Distance vector routing 距离矢量协议(DVP)的示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#riprouting-information-protocol-dv%E7%9A%84%E4%BB%A3%E8%A1%A8"><span class="toc-number">6.7.2.</span> <span class="toc-text">RIP(Routing Information Protocol) DV的代表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#link-state-routing-%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E5%8D%8F%E8%AE%AElsp"><span class="toc-number">6.7.3.</span> <span class="toc-text">Link state routing 链路状态协议(LSP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ospfopen-shortest-path-first"><span class="toc-number">6.7.4.</span> <span class="toc-text">OSPF(Open Shortest Path First)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#igrp-interior-gateway-routing-protocol-and-eigrp-enhanced-igrp"><span class="toc-number">6.7.5.</span> <span class="toc-text">IGRP (Interior Gateway Routing Protocol) and EIGRP (Enhanced IGRP)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vlsmvariable-length-subnet-mask-%E5%8F%AF%E5%8F%98%E9%95%BF%E5%BA%A6%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.</span> <span class="toc-text">VLSM(Variable Length Subnet Mask) 可变长度子网掩码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#classful-routing-vlsm-%E7%BB%8F%E5%85%B8%E8%B7%AF%E7%94%B1%E5%92%8C%E5%8F%AF%E5%8F%98%E9%95%BF%E5%BA%A6%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.1.</span> <span class="toc-text">Classful routing &amp; VLSM 经典路由和可变长度子网掩码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#classful-routing-%E7%BB%8F%E5%85%B8%E8%B7%AF%E7%94%B1classful-routing-%E6%97%A0%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.1.1.</span> <span class="toc-text">Classful routing 经典路由(Classful routing) 无子网掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vlsm-variable-length-subnet-masks-%E5%8F%AF%E5%8F%98%E9%95%BF%E5%BA%A6%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81variable-length-subnet-masks-%E6%9C%89%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.1.2.</span> <span class="toc-text">VLSM — Variable-Length Subnet Masks 可变长度子网掩码(Variable-Length Subnet Masks) 有子网掩码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vslm-%E5%8F%AF%E5%8F%98%E9%95%BF%E5%BA%A6%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.2.</span> <span class="toc-text">VSLM 可变长度子网掩码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8vlsm"><span class="toc-number">7.3.</span> <span class="toc-text">为什么使用VLSM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vlsm%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">7.4.</span> <span class="toc-text">VLSM优缺点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vlsm%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">7.4.1.</span> <span class="toc-text">VLSM的优点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vlsm%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-number">7.4.2.</span> <span class="toc-text">VLSM的缺点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#support-vlsm-routing-protocol-%E6%94%AF%E6%8C%81vlsm%E7%9A%84%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.5.</span> <span class="toc-text">Support VLSM Routing Protocol: 支持VLSM的路由协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vlsm%E7%9A%84%E8%A1%A8%E7%A4%BA%E6%B3%95"><span class="toc-number">7.6.</span> <span class="toc-text">VLSM的表示法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vlsm%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">7.7.</span> <span class="toc-text">VLSM的例子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%92%E5%88%86%E8%83%8C%E6%99%AF"><span class="toc-number">7.7.1.</span> <span class="toc-text">划分背景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%E6%BB%A1%E8%B6%B3%E7%8F%80%E6%96%AF%E7%9A%84%E4%B8%BB%E6%9C%BA%E9%9C%80%E6%B1%82"><span class="toc-number">7.7.2.</span> <span class="toc-text">第一步:满足珀斯的主机需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E4%B8%BA%E5%90%89%E9%9A%86%E5%9D%A1%E5%88%92%E5%88%86%E5%AD%90%E7%BD%91"><span class="toc-number">7.7.3.</span> <span class="toc-text">第二步:为吉隆坡划分子网</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%E4%B8%BA%E6%82%89%E5%B0%BC%E5%92%8C%E6%96%B0%E5%8A%A0%E5%9D%A1%E8%BF%9B%E8%A1%8C%E5%88%86%E9%85%8D%E5%9C%B0%E5%9D%80"><span class="toc-number">7.7.4.</span> <span class="toc-text">第三步:为悉尼和新加坡进行分配地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%E4%B8%BA%E4%B9%8B%E9%97%B4%E7%9A%84%E8%B7%AF%E7%94%B1%E5%9C%B0%E5%9D%80%E8%BF%9B%E8%A1%8C%E5%88%92%E5%88%86"><span class="toc-number">7.7.5.</span> <span class="toc-text">第四步:为之间的路由地址进行划分</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vlsm-%E4%BE%8B%E5%AD%90%E6%80%BB%E7%BB%93"><span class="toc-number">7.8.</span> <span class="toc-text">VLSM: 例子总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%9A%E9%9B%86route-aggregation"><span class="toc-number">7.9.</span> <span class="toc-text">路由聚集(Route Aggregation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%9A%E9%9B%86%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="toc-number">7.10.</span> <span class="toc-text">路由聚集的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E8%B7%AF%E7%94%B1%E8%81%9A%E9%9B%86"><span class="toc-number">7.11.</span> <span class="toc-text">如何进行路由聚集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E8%81%9A%E9%9B%86%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">7.12.</span> <span class="toc-text">路由聚集的优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%9A%94%E7%A6%BB%E7%9A%84%E5%85%B6%E4%BB%96%E5%86%85%E5%AE%B9"><span class="toc-number">7.13.</span> <span class="toc-text">路由隔离的其他内容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%A0%E7%89%B9%E7%BD%91%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE-icmp"><span class="toc-number">8.</span> <span class="toc-text">因特网控制报文协议 ICMP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#icmp-%E6%8A%A5%E6%96%87%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">8.1.</span> <span class="toc-text">ICMP 报文的格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8Dicmp%E6%8A%A5%E6%96%87"><span class="toc-number">8.2.</span> <span class="toc-text">两种ICMP报文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84%E7%AB%99%E4%B8%8D%E5%8F%AF%E5%88%B0%E8%BE%BE"><span class="toc-number">8.3.</span> <span class="toc-text">目的站不可到达</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#icmp-%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">8.4.</span> <span class="toc-text">ICMP 差错报告报文的数据字段的内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8D%E5%BA%94%E5%8F%91%E9%80%81-icmp-%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E7%9A%84%E5%87%A0%E7%A7%8D%E6%83%85%E5%86%B5"><span class="toc-number">8.5.</span> <span class="toc-text">不应发送 ICMP 差错报告报文的几种情况</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ping-packet-internet-groper"><span class="toc-number">8.6.</span> <span class="toc-text">PING (Packet InterNet Groper)</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/22/Static-Analysis-02-Intermediate-Representation/" title="Static Analysis 02 Intermediate Representation"><img src="https://s2.loli.net/2022/05/16/bYkazKZ2OwT9yxl.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="Static Analysis 02 Intermediate Representation"></a><div class="content"><a class="title" href="/2022/09/22/Static-Analysis-02-Intermediate-Representation/" title="Static Analysis 02 Intermediate Representation">Static Analysis 02 Intermediate Representation</a><time datetime="2022-09-22T10:32:35.000Z" title="发表于 2022-09-22 18:32:35">2022-09-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/21/Astar%E7%AE%97%E6%B3%95/" title="Astar算法"><img src="https://s2.loli.net/2022/04/20/3XeMHGig7AzNFCk.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="Astar算法"></a><div class="content"><a class="title" href="/2022/09/21/Astar%E7%AE%97%E6%B3%95/" title="Astar算法">Astar算法</a><time datetime="2022-09-21T05:49:16.000Z" title="发表于 2022-09-21 13:49:16">2022-09-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/19/Concurrency-Algotithms-and-Theories/" title="Concurrency Algotithms and Theories"><img src="https://s2.loli.net/2022/05/16/gNbWjOuKzDrf1px.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="Concurrency Algotithms and Theories"></a><div class="content"><a class="title" href="/2022/09/19/Concurrency-Algotithms-and-Theories/" title="Concurrency Algotithms and Theories">Concurrency Algotithms and Theories</a><time datetime="2022-09-19T11:06:23.000Z" title="发表于 2022-09-19 19:06:23">2022-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/19/2-%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84/" title="2 云计算架构"><img src="https://s2.loli.net/2022/04/21/GbnB1wJh5EPk2Xo.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="2 云计算架构"></a><div class="content"><a class="title" href="/2022/09/19/2-%E4%BA%91%E8%AE%A1%E7%AE%97%E6%9E%B6%E6%9E%84/" title="2 云计算架构">2 云计算架构</a><time datetime="2022-09-19T08:13:23.000Z" title="发表于 2022-09-19 16:13:23">2022-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/18/%E5%B9%B6%E6%9F%A5%E9%9B%86%E6%9E%9A%E4%B8%BE/" title="并查集枚举"><img src="https://s2.loli.net/2022/04/22/W6yMdpnTg3Se7Rf.jpg" onerror='this.onerror=null,this.src="https://s2.loli.net/2022/04/19/zHg7f51jDBVOcR2.jpg"' alt="并查集枚举"></a><div class="content"><a class="title" href="/2022/09/18/%E5%B9%B6%E6%9F%A5%E9%9B%86%E6%9E%9A%E4%B8%BE/" title="并查集枚举">并查集枚举</a><time datetime="2022-09-18T05:39:52.000Z" title="发表于 2022-09-18 13:39:52">2022-09-18</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 胡小小小小睿</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.2},options:{renderActions:{findScript:[10,t=>{for(const a of document.querySelectorAll('script[type^="math/tex"]')){var e=!!a.type.match(/; *mode=display/);const n=new t.options.MathItem(a.textContent,t.inputJax[0],e);e=document.createTextNode("");a.parentNode.replaceChild(e,a),n.start={node:e,delim:"",n:0},n.end={node:e,delim:"",n:0},t.math.push(n)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container:not([display])").forEach(t=>{const e=t.parentNode;("li"===e.nodeName.toLowerCase()?e.parentNode:e).classList.add("has-jax")})},"",!1]}}};const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script><script>function loadValine(){function n(){new Valine(Object.assign({el:"#vcomment",appId:"mhyGN57MG6G9YJ3rtTn90n4c-gzGzoHsz",appKey:"D3FU0mepwLhB8BK48kSAaOLx",avatar:"monsterid",serverURLs:"",emojiMaps:"",path:window.location.pathname,visitor:!0},null))}"function"==typeof Valine?n():getScript("https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js").then(n)}function loadOtherComment(){loadValine()}setTimeout(loadValine,0)</script></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zindex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>